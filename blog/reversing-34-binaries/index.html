<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="&amp;ldquo;If you know the enemy and know yourself, you need not fear the result disassembly of a hundred battles 31 binaries.&amp;quot;
&amp;ndash; Sun Tzu, The Art of War Exploitation
 Overview So you want to hack a program? Go to nsogroup.com &amp;hellip;
Reverse engineering, or &amp;lsquo;reversing&amp;rsquo;, is the process of taking something whose inner workings are not immediately clear or incredibly complex and making sense of them. Thus we see that reversing is not just a skill for security engineers but for all engineers, programmers and problem solvers." />
<meta name="keywords" content=", reversing, hacking, pentesting, x86, Exploit Development" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="#252627" />
<link rel="canonical" href="https://cybernetic.coffee/blog/reversing-34-binaries/" />


    <title>
        
            Reversing 31 Binaries for No Fun and Regret :: Cybernetic Coffee 
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.64cc374c419669695f00d5c55727fea41e0fdc86b9beb1b4d1d1bcf24284f422.css">




<link rel="shortcut icon" href="https://cybernetic.coffee/images/favicon.ico" />


<meta itemprop="name" content="Reversing 31 Binaries for No Fun and Regret">
<meta itemprop="description" content="&ldquo;If you know the enemy and know yourself, you need not fear the result disassembly of a hundred battles 31 binaries.&quot;
&ndash; Sun Tzu, The Art of War Exploitation
 Overview So you want to hack a program? Go to nsogroup.com &hellip;
Reverse engineering, or &lsquo;reversing&rsquo;, is the process of taking something whose inner workings are not immediately clear or incredibly complex and making sense of them. Thus we see that reversing is not just a skill for security engineers but for all engineers, programmers and problem solvers."><meta itemprop="datePublished" content="2021-08-15T00:00:00+00:00" />
<meta itemprop="dateModified" content="2021-08-15T00:00:00+00:00" />
<meta itemprop="wordCount" content="7748">
<meta itemprop="keywords" content="reversing,hacking,pentesting,x86,Exploit Development," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Reversing 31 Binaries for No Fun and Regret"/>
<meta name="twitter:description" content="&ldquo;If you know the enemy and know yourself, you need not fear the result disassembly of a hundred battles 31 binaries.&quot;
&ndash; Sun Tzu, The Art of War Exploitation
 Overview So you want to hack a program? Go to nsogroup.com &hellip;
Reverse engineering, or &lsquo;reversing&rsquo;, is the process of taking something whose inner workings are not immediately clear or incredibly complex and making sense of them. Thus we see that reversing is not just a skill for security engineers but for all engineers, programmers and problem solvers."/>





    <meta property="article:section" content="Hacking" />

    <meta property="article:section" content="Reversing" />

    <meta property="article:section" content="Binary Exploitation" />



    <meta property="article:published_time" content="2021-08-15 00:00:00 &#43;0000 UTC" />








    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <script src="https://kit.fontawesome.com/5eb4842dc5.js" crossorigin="anonymous"></script>

<a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__text">Cybernetic <i class="fas fa-mug-hot"> </i> </span>
            <span class="logo__mark"><i class="fas fa-terminal"></i></span>
            <span class="logo__cursor" style=
                  "
                   background-color:#00ba68;
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://cybernetic.coffee/feed/">Activity Feed</a></li><li><a href="https://cybernetic.coffee/projects/">Projects</a></li><li><a href="https://cybernetic.coffee/blog">Blog</a></li><li><a href="https://cybernetic.coffee/ctf">CTF</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">
        
        <div class="post-info">
            <p>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
                
                    2021-08-15 10:00
                

                
            </p>
        </div>
        

        <article>
            <h2 class="post-title"><a href="https://cybernetic.coffee/blog/reversing-34-binaries/">Reversing 31 Binaries for No Fun and Regret</a></h2>

            

            
            <div class="post-info">

                <div class="sharing-buttons">
                    








<a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?url=https%3a%2f%2fcybernetic.coffee%2fblog%2freversing-34-binaries%2f" target="_blank" rel="noopener" aria-label="" title="Share on twitter">
  <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small">
      <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg>
    </div>
  </div>
</a>



































<a class="resp-sharing-button__link" href="https://reddit.com/submit/?url=https%3a%2f%2fcybernetic.coffee%2fblog%2freversing-34-binaries%2f&amp;resubmit=true&amp;title=Reversing%2031%20Binaries%20for%20No%20Fun%20and%20Regret" target="_blank" rel="noopener" aria-label="" title="Share on reddit">
  <div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/></svg>
    </div>
  </div>
</a>


















<a class="resp-sharing-button__link" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fcybernetic.coffee%2fblog%2freversing-34-binaries%2f&amp;t=Reversing%2031%20Binaries%20for%20No%20Fun%20and%20Regret" target="_blank" rel="noopener" aria-label="" title="Share on hacker news">
  <div class="resp-sharing-button resp-sharing-button--hackernews resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
			<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M0 24V0h24v24H0zM6.951 5.896l4.112 7.708v5.064h1.583v-4.972l4.148-7.799h-1.749l-2.457 4.875c-.372.745-.688 1.434-.688 1.434s-.297-.708-.651-1.434L8.831 5.896h-1.88z"/></svg>
    </div>
  </div>
</a>









                </div>
            </div>
            

            <hr />

            
                
                <aside id="toc">
                
                    <nav id="TableOfContents">
  <ul>
    <li><a href="#overview">Overview</a></li>
    <li><a href="#tooling">Tooling</a></li>
    <li><a href="#basic-structures-and-operations">Basic Structures and Operations</a>
      <ul>
        <li><a href="#_start"><code>_start</code></a></li>
        <li><a href="#mainc"><code>main.c</code></a></li>
        <li><a href="#typesc"><code>types.c</code></a></li>
        <li><a href="#addc"><code>add.c</code></a></li>
        <li><a href="#subc"><code>sub.c</code></a></li>
        <li><a href="#multiplyc"><code>multiply.c</code></a></li>
        <li><a href="#divisionc"><code>division.c</code></a></li>
        <li><a href="#moduloc"><code>modulo.c</code></a></li>
        <li><a href="#conditionalsc"><code>conditionals.c</code></a></li>
        <li><a href="#forc"><code>for.c</code></a></li>
        <li><a href="#whilec"><code>while.c</code></a></li>
        <li><a href="#gotoc"><code>goto.c</code></a></li>
        <li><a href="#arraysc"><code>arrays.c</code></a></li>
        <li><a href="#functionsc"><code>functions.c</code></a></li>
        <li><a href="#bitshiftsc"><code>bitshifts.c</code></a></li>
      </ul>
    </li>
    <li><a href="#scoping-and-intermediate-structures">Scoping and Intermediate Structures</a>
      <ul>
        <li><a href="#argumentsc"><code>arguments.c</code></a></li>
        <li><a href="#structsc"><code>structs.c</code></a></li>
        <li><a href="#globalsc"><code>globals.c</code></a></li>
        <li><a href="#recursionc"><code>recursion.c</code></a></li>
        <li><a href="#switchesc"><code>switches.c</code></a></li>
        <li><a href="#castingc"><code>casting.c</code></a></li>
      </ul>
    </li>
    <li><a href="#io">I/O</a>
      <ul>
        <li><a href="#filesc"><code>files.c</code></a></li>
        <li><a href="#clic"><code>cli.c</code></a></li>
        <li><a href="#socketsc"><code>sockets.c</code></a></li>
      </ul>
    </li>
    <li><a href="#data-structures--basic-algorithms">Data Structures &amp; Basic Algorithms</a>
      <ul>
        <li><a href="#linkedlistc"><code>linkedlist.c</code></a></li>
        <li><a href="#queuec"><code>queue.c</code></a></li>
        <li><a href="#stackc"><code>stack.c</code></a></li>
        <li><a href="#hashtablec"><code>hashtable.c</code></a></li>
        <li><a href="#treesc"><code>trees.c</code></a></li>
      </ul>
    </li>
    <li><a href="#complete-programs">&lsquo;Complete&rsquo; Programs</a>
      <ul>
        <li><a href="#argmultiplexer"><code>argmultiplexer</code></a></li>
        <li><a href="#quickmafs"><code>quickmafs</code></a></li>
      </ul>
    </li>
  </ul>
</nav>
                </aside>
                
            

            

            <div class="post-content">
                <blockquote>
<p><em>&ldquo;If you know the enemy and know yourself, you need not fear the <del>result</del> disassembly of <del>a hundred battles</del> 31 binaries.&quot;</em></p>
<p>&ndash;  Sun Tzu, The Art of <del>War</del> Exploitation</p>
</blockquote>
<h2 id="overview">Overview</h2>
<p><del>So you want to hack a program? Go to nsogroup.com</del> &hellip;</p>
<p>Reverse engineering, or &lsquo;reversing&rsquo;, is the process of taking something whose inner workings are not immediately clear or incredibly complex and making sense of them. Thus we see that reversing is not just a skill for security engineers but for all engineers, programmers and problem solvers.</p>
<blockquote>
<p><em>I&rsquo;ll never stop to be amazed by the amount of efforts people put into not understanding things</em></p>
<p>&ndash; Mark Dowd</p>
</blockquote>
<p>In this post we&rsquo;ll take a look at reverse engineering in the context of ELF 32 bit binaries and the accompanying x86 instruction set. We will see how to use pattern recognition to our advantage, harness the power of dissembler&rsquo;s and untangle assembler logic.</p>
<p><em>This &lsquo;blog&rsquo; was originally called &lsquo;reversing 100 binaries for Fun and Regret&rsquo;, the name change reflects the events that followed. Some explanations are incomplete.</em></p>
<h2 id="tooling">Tooling</h2>
<p>In the bellow assembler code you will notice some adornments to register names and other data. This is produced by the disassembler <a href="https://binary.ninja/">binaryninja</a>, which I use for reversing. It has a 25 minute demo option which is enough time for analyzing miniature programs like many of the ones we will explore. However, if you need more time, ghidra, <a href="https://cutter.re/">cutter</a>, and radare are really good alternatives.</p>
<p><em>Note: The graph view that these tools provide are of particular importance to reversing.</em></p>
<h2 id="basic-structures-and-operations">Basic Structures and Operations</h2>
<p>In this segment we will look at reversing stripped back programs which show case one particular type of <code>C</code> <em>syntax</em>. In doing so we also highlight another powerful reversing technique, which I like to think of as being akin to &lsquo;chosen plaintext&rsquo; attacks, creating and compiling snippets of <code>C</code> code to observe their assembly equivalents.</p>
<h3 id="_start"><code>_start</code></h3>
<p>All ELF binaries contain the <code>_start</code> function and this is where execution begins, however, it is almost never relevant to understanding what the program does from an exploitation perspective but is worth mentioning. It has the following <code>x86</code> signature.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm">_start:
<span style="color:#a6e22e">endbr32</span> 
<span style="color:#a6e22e">xor</span>     ebp, ebp  <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#ae81ff">0x0</span><span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">pop</span>     esi <span style="color:#960050;background-color:#1e0010">{</span>__return_addr<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     ecx, esp <span style="color:#960050;background-color:#1e0010">{</span>arg_4<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">and</span>     esp, <span style="color:#ae81ff">0xfffffff0</span>
<span style="color:#a6e22e">push</span>    eax <span style="color:#960050;background-color:#1e0010">{</span>var_4<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">push</span>    esp <span style="color:#960050;background-color:#1e0010">{</span>var_4<span style="color:#960050;background-color:#1e0010">}</span> <span style="color:#960050;background-color:#1e0010">{</span>var_8<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">push</span>    edx <span style="color:#960050;background-color:#1e0010">{</span>var_c<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">call</span>    sub_10a6
<span style="color:#a6e22e">add</span>     ebx, <span style="color:#ae81ff">0x2f58</span>
<span style="color:#a6e22e">lea</span>     eax, [ebx<span style="color:#f92672">-</span><span style="color:#ae81ff">0x2d9c</span>]  <span style="color:#960050;background-color:#1e0010">{</span>__libc_csu_fini<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">push</span>    eax <span style="color:#960050;background-color:#1e0010">{</span>var_10<span style="color:#960050;background-color:#1e0010">}</span>  <span style="color:#960050;background-color:#1e0010">{</span>__libc_csu_fini<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">lea</span>     eax, [ebx<span style="color:#f92672">-</span><span style="color:#ae81ff">0x2e0c</span>]  <span style="color:#960050;background-color:#1e0010">{</span>__libc_csu_init<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">push</span>    eax <span style="color:#960050;background-color:#1e0010">{</span>var_14<span style="color:#960050;background-color:#1e0010">}</span>  <span style="color:#960050;background-color:#1e0010">{</span>__libc_csu_init<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">push</span>    ecx <span style="color:#960050;background-color:#1e0010">{</span>arg_4<span style="color:#960050;background-color:#1e0010">}</span> <span style="color:#960050;background-color:#1e0010">{</span>var_18<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">push</span>    esi <span style="color:#960050;background-color:#1e0010">{</span>var_1c<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">push</span>    <span style="color:#66d9ef">dword</span> [ebx<span style="color:#f92672">+</span><span style="color:#ae81ff">0x1c</span>] <span style="color:#960050;background-color:#1e0010">{</span>var_20<span style="color:#960050;background-color:#1e0010">}</span>  <span style="color:#960050;background-color:#1e0010">{</span>main<span style="color:#960050;background-color:#1e0010">}</span>  <span style="color:#960050;background-color:#1e0010">{</span>data_3ff8<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">call</span>    __libc_start_main
<span style="color:#960050;background-color:#1e0010">{</span> <span style="color:#a6e22e">Does</span> not return <span style="color:#960050;background-color:#1e0010">}</span>
</code></pre></div><h3 id="mainc"><code>main.c</code></h3>
<p>Main is the real starting point of interest for all C programs, it is from here that all of the programs logic branches out. A typical <code>C</code> code representation looks like the following.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">int</span> 
<span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#66d9ef">const</span> <span style="color:#f92672">*</span>argv[])
{
	<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}
</code></pre></div><p>Lets examine the <code>x86</code> signature.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm">main:
<span style="color:#a6e22e">endbr32</span> 
<span style="color:#a6e22e">push</span>    ebp <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     ebp, esp <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">call</span>    __x86.get_pc_thunk.ax
<span style="color:#a6e22e">add</span>     eax, <span style="color:#ae81ff">0x2e23</span>  <span style="color:#960050;background-color:#1e0010">{</span>_GLOBAL_OFFSET_TABLE_<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     eax, <span style="color:#ae81ff">0x0</span>
<span style="color:#a6e22e">pop</span>     ebp <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">retn</span>     <span style="color:#960050;background-color:#1e0010">{</span>__return_addr<span style="color:#960050;background-color:#1e0010">}</span>
</code></pre></div><p>Firstly we see the label for the function <code>main:</code> which is true of all functions. Then we see the odd instruction <code>endbr32</code> this is another one of those instructions that is not too important to know, but essentially it is just a safety instruction that is <em>&ldquo;used to mark valid jump target addresses of indirect calls and jumps in the program&rdquo;</em> (intel).</p>
<p>Now like all functions the stack frame is setup. We begin by pushing the saved base pointer <code>ebp</code> from the callee function (<code>_start</code> in this case) onto the stack. The new frame is then setup by moving the stack pointer for the frame <code>esp</code> into the base pointer <code>ebp</code>. What this means in that now the current place we are up to, A.K.A the entry to the function, is now the base of our frame (stack). From here we would ordinarily setup space for local function variables and the like but since our &lsquo;main&rsquo; function simply returns <code>0</code> we don&rsquo;t allocate any space in our frame. The next instruction <code>call __x86.get_pc_thunk.ax</code> is another one of those operations which we see frequently but is not of great importance but we will address it anyway. In essence the call simply retrieves the next instructions address from <code>eax</code>. <em>I&rsquo;m not entirely sure why it exists at all or why it is needed</em>. Next we see the assembler loads the address of the <code>GOT</code> or &lsquo;Global offset table&rsquo; into eax and finally we see the return value for the function <code>0</code> being loaded into the standard address for function returns <code>eax</code>.</p>
<p>We now proceed to the functions epilog where we clean up the created stack frame before returning. Again because we do not initialize any local variables in <code>main</code> we don&rsquo;t need to restore any allocated space so we simply pop the saved <code>ebp</code> off the stack. Remember pop takes the last 4 bytes pushed onto the stack and saves them into the specified register, thus, since the last thing pushed was the saved <code>ebp</code> value we know that this will be the value pop&rsquo;d. Finally we call <code>retn</code> which is &lsquo;return near&rsquo; which simply returns us to the callee function.</p>
<h3 id="typesc"><code>types.c</code></h3>
<p><em>Note: when we talk about types here we do so in the context of 32bit programs</em></p>
<p>Now lets take a look at how different types are represented in assembly. We will use the following stripped back <code>C</code> program to do so.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">int</span> 
<span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#66d9ef">const</span> <span style="color:#f92672">*</span>argv[])
{
	<span style="color:#66d9ef">char</span> a <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;a&#39;</span>;
	<span style="color:#66d9ef">short</span> c <span style="color:#f92672">=</span> <span style="color:#ae81ff">40</span>;
	<span style="color:#66d9ef">int</span> b <span style="color:#f92672">=</span> <span style="color:#ae81ff">400</span>;
	<span style="color:#66d9ef">long</span> d <span style="color:#f92672">=</span> <span style="color:#ae81ff">4000000000</span>;
	<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> e <span style="color:#f92672">=</span> <span style="color:#ae81ff">400000000</span>;
	<span style="color:#66d9ef">float</span> f <span style="color:#f92672">=</span> <span style="color:#ae81ff">4000.55</span>;
	<span style="color:#66d9ef">double</span> g <span style="color:#f92672">=</span> <span style="color:#ae81ff">4000.58583</span>;


	<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}
</code></pre></div><p>Once again looking at the <code>x86</code> disassembly in binja we obtain the following block.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm">main:
<span style="color:#a6e22e">endbr32</span> 
<span style="color:#a6e22e">push</span>    ebp <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     ebp, esp <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">and</span>     esp, <span style="color:#ae81ff">0xfffffff8</span>
<span style="color:#a6e22e">sub</span>     esp, <span style="color:#ae81ff">0x20</span>
<span style="color:#a6e22e">call</span>    __x86.get_pc_thunk.ax
<span style="color:#a6e22e">add</span>     eax, <span style="color:#ae81ff">0x2e1d</span>  <span style="color:#960050;background-color:#1e0010">{</span>_GLOBAL_OFFSET_TABLE_<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">byte</span> [esp<span style="color:#f92672">+</span><span style="color:#ae81ff">0x5</span> <span style="color:#960050;background-color:#1e0010">{</span>var_23<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0x61</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">word</span> [esp<span style="color:#f92672">+</span><span style="color:#ae81ff">0x6</span> <span style="color:#960050;background-color:#1e0010">{</span>var_22<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0x28</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [esp<span style="color:#f92672">+</span><span style="color:#ae81ff">0x8</span> <span style="color:#960050;background-color:#1e0010">{</span>var_20<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0x190</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [esp<span style="color:#f92672">+</span><span style="color:#ae81ff">0xc</span> <span style="color:#960050;background-color:#1e0010">{</span>var_1c<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0xee6b2800</span>  <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#ae81ff">0xee6b2800</span><span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [esp<span style="color:#f92672">+</span><span style="color:#ae81ff">0x10</span> <span style="color:#960050;background-color:#1e0010">{</span>var_18<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0x17d78400</span>
<span style="color:#a6e22e">fld</span>     <span style="color:#66d9ef">dword</span> [eax<span style="color:#f92672">-</span><span style="color:#ae81ff">0x1fd4</span>]
<span style="color:#a6e22e">fstp</span>    <span style="color:#66d9ef">dword</span> [esp<span style="color:#f92672">+</span><span style="color:#ae81ff">0x14</span> <span style="color:#960050;background-color:#1e0010">{</span>var_14<span style="color:#960050;background-color:#1e0010">}</span>]
<span style="color:#a6e22e">fld</span>     <span style="color:#66d9ef">qword</span> [eax<span style="color:#f92672">-</span><span style="color:#ae81ff">0x1fcc</span>]
<span style="color:#a6e22e">fstp</span>    <span style="color:#66d9ef">qword</span> [esp<span style="color:#f92672">+</span><span style="color:#ae81ff">0x18</span> <span style="color:#960050;background-color:#1e0010">{</span>var_10<span style="color:#960050;background-color:#1e0010">}</span>]
<span style="color:#a6e22e">mov</span>     eax, <span style="color:#ae81ff">0x0</span>
<span style="color:#a6e22e">leave</span>    <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">retn</span>     <span style="color:#960050;background-color:#1e0010">{</span>__return_addr<span style="color:#960050;background-color:#1e0010">}</span>
</code></pre></div><p>Now that we know how the main function, and functions more broadly, are setup we cant start by instantly ignoring all of the logic to setup the frame and &lsquo;weird&rsquo; calls we explored prior. Thus we end up with an abstracted signature like the following.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm"><span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">byte</span> [esp<span style="color:#f92672">+</span><span style="color:#ae81ff">0x5</span> <span style="color:#960050;background-color:#1e0010">{</span>var_23<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0x61</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">word</span> [esp<span style="color:#f92672">+</span><span style="color:#ae81ff">0x6</span> <span style="color:#960050;background-color:#1e0010">{</span>var_22<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0x28</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [esp<span style="color:#f92672">+</span><span style="color:#ae81ff">0x8</span> <span style="color:#960050;background-color:#1e0010">{</span>var_20<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0x190</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [esp<span style="color:#f92672">+</span><span style="color:#ae81ff">0xc</span> <span style="color:#960050;background-color:#1e0010">{</span>var_1c<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0xee6b2800</span>  <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#ae81ff">0xee6b2800</span><span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [esp<span style="color:#f92672">+</span><span style="color:#ae81ff">0x10</span> <span style="color:#960050;background-color:#1e0010">{</span>var_18<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0x17d78400</span>
<span style="color:#a6e22e">fld</span>     <span style="color:#66d9ef">dword</span> [eax<span style="color:#f92672">-</span><span style="color:#ae81ff">0x1fd4</span>]
<span style="color:#a6e22e">fstp</span>    <span style="color:#66d9ef">dword</span> [esp<span style="color:#f92672">+</span><span style="color:#ae81ff">0x14</span> <span style="color:#960050;background-color:#1e0010">{</span>var_14<span style="color:#960050;background-color:#1e0010">}</span>]
<span style="color:#a6e22e">fld</span>     <span style="color:#66d9ef">qword</span> [eax<span style="color:#f92672">-</span><span style="color:#ae81ff">0x1fcc</span>]
<span style="color:#a6e22e">fstp</span>    <span style="color:#66d9ef">qword</span> [esp<span style="color:#f92672">+</span><span style="color:#ae81ff">0x18</span> <span style="color:#960050;background-color:#1e0010">{</span>var_10<span style="color:#960050;background-color:#1e0010">}</span>]
</code></pre></div><p>So as we expect for our 7 type variables we see 7 variables being initialized here. The important things we care about here to reverse the logic are the <code>x86</code> types and the weird instructions we see.</p>
<p>Lets start by revisting the <code>x86</code> types.</p>
<ul>
<li><code>byte</code> - In a shocking twist this is a <code>8 bit (1 byte)</code> quantity
<ul>
<li><code>0 - 255</code> unsigned range</li>
</ul>
</li>
<li><code>word</code> - A word is two bytes giving us a <code>16 bit (2 byte)</code> quantity
<ul>
<li><code>0 - 65535</code> unsigned range</li>
</ul>
</li>
<li><code>dword</code> - A double word, you guessed it, a <code>32 bit (4 byte)</code> quantity
<ul>
<li><code>0 - 4294967295</code> unsigned range</li>
</ul>
</li>
<li><code>qword</code> - A quad word, a <code>64 bit (8 byte)</code> quantity
<ul>
<li><code>0 - 18446744073709551615</code> unsigned range</li>
</ul>
</li>
</ul>
<p>With this in mind we can start converting some of our easier types into their <code>C</code> equivalents.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm"><span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">byte</span> [esp<span style="color:#f92672">+</span><span style="color:#ae81ff">0x5</span> <span style="color:#960050;background-color:#1e0010">{</span>var_23<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0x61</span>
</code></pre></div><p>This value must be a <code>char</code> and the hex value <code>0x61</code> falling within the ASCII character range is a dead giveaway that its the character <code>a</code>. So we now have the following <code>C</code> snippet</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">int</span> 
<span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#66d9ef">const</span> <span style="color:#f92672">*</span>argv[])
{
	<span style="color:#66d9ef">char</span> var_23 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;a&#39;</span>;
}
</code></pre></div><p>Next up we have another relatively straightforward one.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm"><span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">word</span> [esp<span style="color:#f92672">+</span><span style="color:#ae81ff">0x6</span> <span style="color:#960050;background-color:#1e0010">{</span>var_22<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0x28</span>
</code></pre></div><p>For starters we know we are dealing with a word which is <code>16 bits</code> in size. If we look at some <code>C</code> types we can accumulate the following list. For a better list see <a href="https://devsheets.cybernetic.coffee/programming-languages/basic-c-syntax/#basic-types">Basic Types Table</a>.</p>
<ul>
<li><code>char</code> - <code>1 byte</code>
<ul>
<li><code>0 - 255</code> (unsigned)</li>
<li><code>-128 - 127</code> (signed)</li>
</ul>
</li>
<li><code>short</code> - <code>2 bytes</code>
<ul>
<li><code>0 - 65535</code> (unsigned)</li>
<li><code>-32,768 - 32,767</code> (signed)</li>
</ul>
</li>
<li><code>int</code> - <code>4 bytes</code>
<ul>
<li><code>0 - 4294967295</code> (unsigned)</li>
<li><code>-2,147,483,648 - 2,147,483,647</code> (signed)</li>
</ul>
</li>
</ul>
<p>Now comparing this to the <code>x86</code> equivalents we know that a word will range from <code>0 - 65535</code> which corresponds to a short. Next we see <code>0x28</code> is moved into the place the variable points in memory,</p>
<ul>
<li><code>[]</code> indicates a dereference</li>
</ul>
<p>if we convert this to decimal we get the value <code>40</code> and thus we obtain the next <code>C</code> snippet.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">int</span> 
<span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#66d9ef">const</span> <span style="color:#f92672">*</span>argv[])
{
	<span style="color:#66d9ef">char</span> var_23 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;a&#39;</span>;
	<span style="color:#66d9ef">short</span> var_22 <span style="color:#f92672">=</span> <span style="color:#ae81ff">40</span>;
}
</code></pre></div><p>We now proceed with the following snippet.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm"><span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [esp<span style="color:#f92672">+</span><span style="color:#ae81ff">0x8</span> <span style="color:#960050;background-color:#1e0010">{</span>var_20<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0x190</span>
</code></pre></div><p>At this stage we have the pattern sorted so we skip straight to matching the size and convert the hex to decimal <code>400</code> and produce the <code>C</code> snippet.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">int</span> 
<span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#66d9ef">const</span> <span style="color:#f92672">*</span>argv[])
{
	<span style="color:#66d9ef">char</span> var_23 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;a&#39;</span>;
	<span style="color:#66d9ef">short</span> var_22 <span style="color:#f92672">=</span> <span style="color:#ae81ff">40</span>;
	<span style="color:#66d9ef">int</span> var_20 <span style="color:#f92672">=</span> <span style="color:#ae81ff">400</span>;
}
</code></pre></div><p>Now its time for,</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm"><span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [esp<span style="color:#f92672">+</span><span style="color:#ae81ff">0xc</span> <span style="color:#960050;background-color:#1e0010">{</span>var_1c<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0xee6b2800</span>  <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#ae81ff">0xee6b2800</span><span style="color:#960050;background-color:#1e0010">}</span>
</code></pre></div><p>at this point you&rsquo;re like its a <code>int</code> mate, and you&rsquo;d be correct, for 32 bit programs, and ofc systems, <code>longs</code> and <code>ints</code> are both the same size <code>4 bytes</code>. Hence we make the hex conversion and assume an integer. <em>This assumption does not matter since any vulnerabilities introduced by a <code>long</code> would be identical for an <code>int</code></em>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">int</span> 
<span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#66d9ef">const</span> <span style="color:#f92672">*</span>argv[])
{
	<span style="color:#66d9ef">char</span> var_23 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;a&#39;</span>;
	<span style="color:#66d9ef">short</span> var_22 <span style="color:#f92672">=</span> <span style="color:#ae81ff">40</span>;
	<span style="color:#66d9ef">int</span> var_20 <span style="color:#f92672">=</span> <span style="color:#ae81ff">400</span>;
	<span style="color:#66d9ef">int</span> var_1c <span style="color:#f92672">=</span> <span style="color:#ae81ff">4000000000</span>;
}
</code></pre></div><p>To save time with the following snippet we encounter a similar situation where the number of bytes used to represent the value is a <code>dword</code> which is the same size as the previously examined <code>int</code> and <code>long</code> values and thus all we can guarantee is that it will have at least the same size as an integer quantity in a 32 bit environment.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm"><span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [esp<span style="color:#f92672">+</span><span style="color:#ae81ff">0x10</span> <span style="color:#960050;background-color:#1e0010">{</span>var_18<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0x17d78400</span>

</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">int</span> 
<span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#66d9ef">const</span> <span style="color:#f92672">*</span>argv[])
{
	<span style="color:#66d9ef">char</span> var_23 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;a&#39;</span>;
	<span style="color:#66d9ef">short</span> var_22 <span style="color:#f92672">=</span> <span style="color:#ae81ff">40</span>;
	<span style="color:#66d9ef">int</span> var_20 <span style="color:#f92672">=</span> <span style="color:#ae81ff">400</span>;
	<span style="color:#66d9ef">int</span> var_1c <span style="color:#f92672">=</span> <span style="color:#ae81ff">4000000000</span>;
	<span style="color:#66d9ef">int</span> var_18 <span style="color:#f92672">=</span> <span style="color:#ae81ff">400000000</span>;
}
</code></pre></div><p>Now we start getting into the &lsquo;interesting&rsquo; parts of the program, lets look at the next snippet.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm"><span style="color:#a6e22e">fld</span>     <span style="color:#66d9ef">dword</span> [eax<span style="color:#f92672">-</span><span style="color:#ae81ff">0x1fd4</span>]
<span style="color:#a6e22e">fstp</span>    <span style="color:#66d9ef">dword</span> [esp<span style="color:#f92672">+</span><span style="color:#ae81ff">0x14</span> <span style="color:#960050;background-color:#1e0010">{</span>var_14<span style="color:#960050;background-color:#1e0010">}</span>]
</code></pre></div><p>Here we encounter two new unfamiliar instructions.</p>
<ul>
<li><code>fld</code> - Load Floating Point Value</li>
<li><code>fstp</code> - Store Floating Point Value</li>
</ul>
<p>Both are irresponsible for interacting with the floating point register so we know we are dealing with some kind of floating point value. What is interesting however here is that we don&rsquo;t see any associated value being moved around we just get a dereference to <code>var_14</code>. This is because for whatever reason floating point values are stored in the <code>.rodata</code> section of the ELF. The information we can figure out here tho is the type of precision associated with the floating point value. In this case we see that the size of the data referenced at that memory location is a <code>dword</code>. That means the floating point value is represented by a <code>4 byte</code> value. Hence we can determine by looking at the spec that this is a floating point value with the precision of the <code>C</code> type <code>float</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">int</span> 
<span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#66d9ef">const</span> <span style="color:#f92672">*</span>argv[])
{
	<span style="color:#66d9ef">char</span> var_23 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;a&#39;</span>;
	<span style="color:#66d9ef">short</span> var_22 <span style="color:#f92672">=</span> <span style="color:#ae81ff">40</span>;
	<span style="color:#66d9ef">int</span> var_20 <span style="color:#f92672">=</span> <span style="color:#ae81ff">400</span>;
	<span style="color:#66d9ef">int</span> var_1c <span style="color:#f92672">=</span> <span style="color:#ae81ff">4000000000</span>;
	<span style="color:#66d9ef">int</span> var_18 <span style="color:#f92672">=</span> <span style="color:#ae81ff">400000000</span>;
	<span style="color:#66d9ef">float</span> var_14; <span style="color:#75715e">// unknown value
</span><span style="color:#75715e"></span>}
</code></pre></div><p>Finally we see a very similar instruction sequence.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm"><span style="color:#a6e22e">fld</span>     <span style="color:#66d9ef">qword</span> [eax<span style="color:#f92672">-</span><span style="color:#ae81ff">0x1fcc</span>]
<span style="color:#a6e22e">fstp</span>    <span style="color:#66d9ef">qword</span> [esp<span style="color:#f92672">+</span><span style="color:#ae81ff">0x18</span> <span style="color:#960050;background-color:#1e0010">{</span>var_10<span style="color:#960050;background-color:#1e0010">}</span>]
</code></pre></div><p>With the only difference being the precision of the floating point value which we now see has increased to <code>8 bytes</code> in size. This corresponds to the <code>C</code> type of <code>double</code>.</p>
<p>This completes our recovered <code>C</code> snippet leaving us with two unresolved values of known type. If we desired we could easily recover the values with further static analysis on the <code>.rodata</code> section or with dynamic analysis in GDB.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C">{
	<span style="color:#66d9ef">char</span> var_23 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;a&#39;</span>;
	<span style="color:#66d9ef">short</span> var_22 <span style="color:#f92672">=</span> <span style="color:#ae81ff">40</span>;
	<span style="color:#66d9ef">int</span> var_20 <span style="color:#f92672">=</span> <span style="color:#ae81ff">400</span>;
	<span style="color:#66d9ef">int</span> var_1c <span style="color:#f92672">=</span> <span style="color:#ae81ff">4000000000</span>;
	<span style="color:#66d9ef">int</span> var_18 <span style="color:#f92672">=</span> <span style="color:#ae81ff">400000000</span>;
	<span style="color:#66d9ef">float</span> var_14; <span style="color:#75715e">// unknown value
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">double</span> var_10; <span style="color:#75715e">// unknown value
</span><span style="color:#75715e"></span>}
</code></pre></div><h3 id="addc"><code>add.c</code></h3>
<p>Next up lets get into some basic arithmetic starting with every computers favorite, addition.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">int</span>
<span style="color:#a6e22e">add</span>()
{
	<span style="color:#66d9ef">int</span> a <span style="color:#f92672">=</span> <span style="color:#ae81ff">40</span>;
	<span style="color:#66d9ef">int</span> b <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>;
	<span style="color:#66d9ef">return</span> a <span style="color:#f92672">+</span> b;
}


<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>() {add();}
</code></pre></div><p>Opening the compiled binary in binja we get the following disassembly for the <code>add</code> function.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm">add:
<span style="color:#a6e22e">endbr32</span> 
<span style="color:#a6e22e">push</span>    ebp <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     ebp, esp <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">sub</span>     esp, <span style="color:#ae81ff">0x10</span>
<span style="color:#a6e22e">call</span>    __x86.get_pc_thunk.ax
<span style="color:#a6e22e">add</span>     eax, <span style="color:#ae81ff">0x2e20</span>  <span style="color:#960050;background-color:#1e0010">{</span>_GLOBAL_OFFSET_TABLE_<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x8</span> <span style="color:#960050;background-color:#1e0010">{</span>var_c<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0x28</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x4</span> <span style="color:#960050;background-color:#1e0010">{</span>var_8<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0x2</span>
<span style="color:#a6e22e">mov</span>     edx, <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x8</span> <span style="color:#960050;background-color:#1e0010">{</span>var_c<span style="color:#960050;background-color:#1e0010">}</span>]
<span style="color:#a6e22e">mov</span>     eax, <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x4</span> <span style="color:#960050;background-color:#1e0010">{</span>var_8<span style="color:#960050;background-color:#1e0010">}</span>]
<span style="color:#a6e22e">add</span>     eax, edx  <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#ae81ff">0x2a</span><span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">leave</span>    <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">retn</span>     <span style="color:#960050;background-color:#1e0010">{</span>__return_addr<span style="color:#960050;background-color:#1e0010">}</span>
</code></pre></div><p>As we will often do from here start by nuking the &lsquo;boilerplate&rsquo; used to setup and collapse the stackframe.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm"><span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x8</span> <span style="color:#960050;background-color:#1e0010">{</span>var_c<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0x28</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x4</span> <span style="color:#960050;background-color:#1e0010">{</span>var_8<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0x2</span>
<span style="color:#a6e22e">mov</span>     edx, <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x8</span> <span style="color:#960050;background-color:#1e0010">{</span>var_c<span style="color:#960050;background-color:#1e0010">}</span>]
<span style="color:#a6e22e">mov</span>     eax, <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x4</span> <span style="color:#960050;background-color:#1e0010">{</span>var_8<span style="color:#960050;background-color:#1e0010">}</span>]
<span style="color:#a6e22e">add</span>     eax, edx  <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#ae81ff">0x2a</span><span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">leave</span>    <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
</code></pre></div><p>To begin with we see two variables being setup. Now that we can reverse types it&rsquo;s pretty easy to see that we assign two integers as follows.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">int</span> var_c <span style="color:#f92672">=</span> <span style="color:#ae81ff">40</span>;
<span style="color:#66d9ef">int</span> var_8 <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>;
</code></pre></div><p>Over the next few lines we see the variables being moved into general purpose registers <code>edx</code> and <code>eax</code> in preparation for the <code>add</code> instruction. The <code>add</code> instruction takes in two parameters a source register which will be updated with the value stored in the second register. Thus in this case the value in <code>eax</code> is added with the value in <code>edx</code> and the computed sum stored back into <code>eax</code>. We then see the leave instruction is executed and the function terminates.</p>
<p>It is at this point that we should recall the <code>x86</code> calling convention, wherein it is standard to return the results of function calls in the <code>eax</code> register. This should now make it obvious to us that the result of the addition operation is returned from the function directly rather than storing it in a result variable and then returning that. Thus we obtain the final recovered <code>C</code> snippet.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">int</span>
<span style="color:#a6e22e">add</span>()
{
	<span style="color:#66d9ef">int</span> var_c <span style="color:#f92672">=</span> <span style="color:#ae81ff">40</span>;
	<span style="color:#66d9ef">int</span> var_8 <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>;

	<span style="color:#66d9ef">return</span> var_8 <span style="color:#f92672">+</span> var_c; 
}
</code></pre></div><h3 id="subc"><code>sub.c</code></h3>
<p>Now lets take a look at the inverse operation subtraction.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">int</span>
<span style="color:#a6e22e">sub</span>()
{
	<span style="color:#66d9ef">int</span> a <span style="color:#f92672">=</span> <span style="color:#ae81ff">40</span>;
	<span style="color:#66d9ef">int</span> b <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>;
	<span style="color:#66d9ef">return</span> a <span style="color:#f92672">-</span> b;
}


<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>() {sub();}
</code></pre></div><p>As you might expect the disassembly is virtually identical to add so we wont spend much time here.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm">sub:
<span style="color:#a6e22e">endbr32</span> 
<span style="color:#a6e22e">push</span>    ebp <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     ebp, esp <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">sub</span>     esp, <span style="color:#ae81ff">0x10</span>
<span style="color:#a6e22e">call</span>    __x86.get_pc_thunk.ax
<span style="color:#a6e22e">add</span>     eax, <span style="color:#ae81ff">0x2e20</span>  <span style="color:#960050;background-color:#1e0010">{</span>_GLOBAL_OFFSET_TABLE_<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x8</span> <span style="color:#960050;background-color:#1e0010">{</span>var_c<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0x28</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x4</span> <span style="color:#960050;background-color:#1e0010">{</span>var_8<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0x2</span>
<span style="color:#a6e22e">mov</span>     eax, <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x8</span> <span style="color:#960050;background-color:#1e0010">{</span>var_c<span style="color:#960050;background-color:#1e0010">}</span>]
<span style="color:#a6e22e">sub</span>     eax, <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x4</span>]  <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#ae81ff">0x26</span><span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">leave</span>    <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">retn</span>     <span style="color:#960050;background-color:#1e0010">{</span>__return_addr<span style="color:#960050;background-color:#1e0010">}</span>

</code></pre></div><p>The only difference being that the <code>add</code> instruction is replaced with the <code>sub</code> instruction which works in the exact same fashion as <code>add</code> where the value in the first register parameter is reduced by the amount stored in the second register parameter and the result stored back into the first register. However, in this case the compiler just takes the value stored at the memory address of <code>var_8</code> as the second parameter rather than storing it in a general purpose register (like <code>edx</code>). Hence we have the following <code>C</code> snippet.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">int</span>
<span style="color:#a6e22e">sub</span>()
{
	<span style="color:#66d9ef">int</span> var_c <span style="color:#f92672">=</span> <span style="color:#ae81ff">40</span>;
	<span style="color:#66d9ef">int</span> var_8 <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>;

	<span style="color:#75715e">// order is important
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">return</span> var_c <span style="color:#f92672">-</span> var_8; 
}
</code></pre></div><h3 id="multiplyc"><code>multiply.c</code></h3>
<p>Now for disguised addition, lets check out multiplication.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">int</span>
<span style="color:#a6e22e">multiply</span> ()
{
	<span style="color:#66d9ef">int</span> a <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span>;
	<span style="color:#66d9ef">int</span> b <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>;
	<span style="color:#66d9ef">int</span> c <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>;

	<span style="color:#66d9ef">return</span> a <span style="color:#f92672">*</span> b <span style="color:#f92672">*</span> c;
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>() {multiply();}
</code></pre></div><p>This is the compiled codes disassembly.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm">multiply:
<span style="color:#a6e22e">endbr32</span> 
<span style="color:#a6e22e">push</span>    ebp <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     ebp, esp <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">sub</span>     esp, <span style="color:#ae81ff">0x10</span>
<span style="color:#a6e22e">call</span>    __x86.get_pc_thunk.ax
<span style="color:#a6e22e">add</span>     eax, <span style="color:#ae81ff">0x2e20</span>  <span style="color:#960050;background-color:#1e0010">{</span>_GLOBAL_OFFSET_TABLE_<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0xc</span> <span style="color:#960050;background-color:#1e0010">{</span>var_10<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0x7</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x8</span> <span style="color:#960050;background-color:#1e0010">{</span>var_c<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0x2</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x4</span> <span style="color:#960050;background-color:#1e0010">{</span>var_8<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0x3</span>
<span style="color:#a6e22e">mov</span>     eax, <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0xc</span> <span style="color:#960050;background-color:#1e0010">{</span>var_10<span style="color:#960050;background-color:#1e0010">}</span>]
<span style="color:#a6e22e">imul</span>    eax, <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x8</span>]
<span style="color:#a6e22e">imul</span>    eax, <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x4</span>]  <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#ae81ff">0x2a</span><span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">leave</span>    <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">retn</span>     <span style="color:#960050;background-color:#1e0010">{</span>__return_addr<span style="color:#960050;background-color:#1e0010">}</span>
</code></pre></div><p>Now that we know about register conventions we can already put together some assumptions about the program with just a quick passover the disassembly. We know that the result is being computed and returned directly via the <code>eax</code> register and that there are 3 variables involved. Additionally all the variables are of size <code>dword</code> so we can also attribute typing information to the variables. Simple conversion of the hexadecimal constants we have the following rough scaffold.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">int</span>
<span style="color:#a6e22e">multiply</span> ()
{
	<span style="color:#66d9ef">int</span> var_10 <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span>;
	<span style="color:#66d9ef">int</span> var_c <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>;
	<span style="color:#66d9ef">int</span> var_8 <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>;

	<span style="color:#66d9ef">return</span> <span style="color:#75715e">/*todo*/</span>;
}
</code></pre></div><p>Now lets address the opcode in the room, <code>imul</code> or &lsquo;signed multiply&rsquo;. According to a <a href="https://www.felixcloutier.com/x86/imul">website</a> that hasn&rsquo;t discovered CSS which means it can be trusted completely:</p>
<blockquote>
<p><em>&ldquo;imul Performs a signed multiplication of two operands. This instruction has three forms, depending on the number of operands.&quot;</em></p>
</blockquote>
<p>Thus <code>imul</code> behaves differently depending on the number of operands, the cases are (approximately) as follows:</p>
<p><strong>One operand</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm"><span style="color:#a6e22e">imul</span> edi
<span style="color:#a6e22e">imul</span> <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x42</span>]
</code></pre></div><p>The value in the source operand, which can be either a memory location or a general purpose register, is multiplied with the value in the <code>eax</code> register (or its 8 bit equivalent <code>al</code> depending on the size of the value) and the result stored/returned in the <code>edx</code> or <code>eax</code> registers.</p>
<p><strong>Two operands</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm"><span style="color:#a6e22e">imul</span> eax, edi
<span style="color:#a6e22e">imul</span> eax, <span style="color:#ae81ff">0x42</span>
<span style="color:#a6e22e">imul</span> eax, <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x42</span>]
</code></pre></div><p>The value in the destination operand, which must be a general purpose register, is multiplied with the source operand, which may be either a general purpose register, constant value or a memory location, and the result stored/returned in the destination register/operand.</p>
<p><strong>Three operands</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm"><span style="color:#a6e22e">imul</span> eax, edi, <span style="color:#ae81ff">0x42</span>
<span style="color:#a6e22e">imul</span> eax, <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x42</span>], <span style="color:#ae81ff">0x42</span>
</code></pre></div><p>The second operand, which can either be a general purpose register or a memory location, is multiplied with the third operand, which must be a constant value, and the result is stored in the first operand, which must be a general purpose register.</p>
<p><strong>Our Case</strong></p>
<p>Here we deal with <code>imul's</code> of the second format with two operands the second being a location in memory. Thus we can follow the logic</p>
<ol>
<li>
<p><code>mov     eax, dword [ebp-0xc {var_10}]</code> the value in <code>var_10</code> is stored into the <code>eax</code> register</p>
<p>i. <code>eax = 7</code></p>
</li>
<li>
<p><code>imul    eax, dword [ebp-0x8]</code> the value in eax is multiplied with the value in <code>var_c</code></p>
<p>ii. <code>eax = 7 * 2 = 14</code></p>
</li>
<li>
<p><code>imul    eax, dword [ebp-0x4]</code> the value in eax is multiplied with the value in <code>var_8</code></p>
<p>iii. <code>eax = 14 * 3 = 42</code></p>
</li>
</ol>
<p>Thus we obtain the final reconstructed <code>C</code> snippet.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">int</span>
<span style="color:#a6e22e">multiply</span> ()
{
	<span style="color:#66d9ef">int</span> var_10 <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span>;
	<span style="color:#66d9ef">int</span> var_c <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>;
	<span style="color:#66d9ef">int</span> var_8 <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>;

	<span style="color:#66d9ef">return</span> var_10 <span style="color:#f92672">*</span> var_c <span style="color:#f92672">*</span> var_8;
}
</code></pre></div><h3 id="divisionc"><code>division.c</code></h3>
<p>Now lets take a look at a slightly different one, division.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">int</span> 
<span style="color:#a6e22e">divide</span>()
{
	<span style="color:#66d9ef">int</span> res;

	<span style="color:#66d9ef">int</span> a <span style="color:#f92672">=</span> <span style="color:#ae81ff">235000</span>;
	<span style="color:#66d9ef">int</span> b <span style="color:#f92672">=</span> <span style="color:#ae81ff">431231</span>;

	res <span style="color:#f92672">=</span> a <span style="color:#f92672">/</span> b;

	<span style="color:#66d9ef">return</span> res;
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>() {divide();}
</code></pre></div><p>Which has the following signature in <code>x86</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm">divide:
<span style="color:#a6e22e">endbr32</span> 
<span style="color:#a6e22e">push</span>    ebp <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     ebp, esp <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">sub</span>     esp, <span style="color:#ae81ff">0x10</span>
<span style="color:#a6e22e">call</span>    __x86.get_pc_thunk.ax
<span style="color:#a6e22e">add</span>     eax, <span style="color:#ae81ff">0x2e20</span>  <span style="color:#960050;background-color:#1e0010">{</span>_GLOBAL_OFFSET_TABLE_<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0xc</span> <span style="color:#960050;background-color:#1e0010">{</span>var_10<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0xe01d0c0</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x8</span> <span style="color:#960050;background-color:#1e0010">{</span>var_c<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0x19b41018</span>
<span style="color:#a6e22e">mov</span>     eax, <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0xc</span> <span style="color:#960050;background-color:#1e0010">{</span>var_10<span style="color:#960050;background-color:#1e0010">}</span>]
<span style="color:#a6e22e">cdq</span>       <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#ae81ff">0xe01d0c0</span><span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">idiv</span>    <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x8</span> <span style="color:#960050;background-color:#1e0010">{</span>var_c<span style="color:#960050;background-color:#1e0010">}</span>]
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x4</span> <span style="color:#960050;background-color:#1e0010">{</span>var_8<span style="color:#960050;background-color:#1e0010">}</span>], eax
<span style="color:#a6e22e">mov</span>     eax, <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x4</span> <span style="color:#960050;background-color:#1e0010">{</span>var_8<span style="color:#960050;background-color:#1e0010">}</span>]
<span style="color:#a6e22e">leave</span>    <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">retn</span>     <span style="color:#960050;background-color:#1e0010">{</span>__return_addr<span style="color:#960050;background-color:#1e0010">}</span>
</code></pre></div><p>We see the typical stack frame setup stuff going on ra ra ra, ignore all that and go straight for our freebies, the variable setups.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">int</span> var_10 <span style="color:#f92672">=</span> <span style="color:#ae81ff">235000000</span>;
<span style="color:#66d9ef">int</span> var_c <span style="color:#f92672">=</span> <span style="color:#ae81ff">431231000</span>;
</code></pre></div><p>Then we encounter this series of events.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm"><span style="color:#a6e22e">mov</span>     eax, <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0xc</span> <span style="color:#960050;background-color:#1e0010">{</span>var_10<span style="color:#960050;background-color:#1e0010">}</span>]
<span style="color:#a6e22e">cdq</span>       <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#ae81ff">0xe01d0c0</span><span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">idiv</span>    <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x8</span> <span style="color:#960050;background-color:#1e0010">{</span>var_c<span style="color:#960050;background-color:#1e0010">}</span>]
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x4</span> <span style="color:#960050;background-color:#1e0010">{</span>var_8<span style="color:#960050;background-color:#1e0010">}</span>], eax
</code></pre></div><p>We see our value in <code>var_10</code> being shoveled into the <code>eax</code> register which is a fair indicator that we are about to perform some operation or a function call. On the next line we have the <code>cdq</code> instruction which converts the value stored in <code>eax</code> to either a double word or a quadword depending on the values original &lsquo;type&rsquo;. Thus in this case we convert a <code>dword</code> to a <code>qword</code> to facilitate the next instruction. The <code>idiv</code> instruction handles signed division of (<a href="#moduloc">smaller</a>) numbers in <code>x86</code>. It takes in one operand only as a divisor and divides the value stored in the <code>eax</code> register by that operands value storing the result back into <code>eax</code> (as all functions do conventionally). Finally we see <code>eax</code> saved into an intermediate variable <code>var_8</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">int</span> div_result;

<span style="color:#66d9ef">int</span> var_10 <span style="color:#f92672">=</span> <span style="color:#ae81ff">235000000</span>;
<span style="color:#66d9ef">int</span> var_c <span style="color:#f92672">=</span> <span style="color:#ae81ff">431231000</span>;

<span style="color:#75715e">// take note of order, eax value first
</span><span style="color:#75715e"></span>div_result <span style="color:#f92672">=</span> var_10 <span style="color:#f92672">/</span> var_c;
</code></pre></div><p>In the last block we have,</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm"><span style="color:#a6e22e">mov</span>     eax, <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x4</span> <span style="color:#960050;background-color:#1e0010">{</span>var_8<span style="color:#960050;background-color:#1e0010">}</span>]
<span style="color:#a6e22e">leave</span>    <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">retn</span>     <span style="color:#960050;background-color:#1e0010">{</span>__return_addr<span style="color:#960050;background-color:#1e0010">}</span>
</code></pre></div><p>which we know means the result in <code>var_8</code> is being returned from the function. Thus we have the final <code>C</code> snippet.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">int</span>
<span style="color:#a6e22e">divide</span>()
{
	<span style="color:#66d9ef">int</span> div_result;
	<span style="color:#66d9ef">int</span> var_10 <span style="color:#f92672">=</span> <span style="color:#ae81ff">235000000</span>;
	<span style="color:#66d9ef">int</span> var_c <span style="color:#f92672">=</span> <span style="color:#ae81ff">431231000</span>;

	<span style="color:#75715e">// take note of order, eax value first
</span><span style="color:#75715e"></span>	div_result <span style="color:#f92672">=</span> var_10 <span style="color:#f92672">/</span> var_c;

	<span style="color:#66d9ef">return</span> div_result;
}

</code></pre></div><h3 id="moduloc"><code>modulo.c</code></h3>
<p>I find modulo to be one of the more interesting arithmetic operations to reverse since it highlights &lsquo;weird&rsquo; compiler optimizations.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">int</span> 
<span style="color:#a6e22e">modulo</span> ()
{
	<span style="color:#66d9ef">int</span> res;
	<span style="color:#66d9ef">int</span> a <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>;
	<span style="color:#75715e">/* modulo*/</span>

	res <span style="color:#f92672">=</span> a <span style="color:#f92672">%</span> <span style="color:#ae81ff">3</span>;
	<span style="color:#66d9ef">return</span> res;
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>() {modulo();}
</code></pre></div><p>Bellow is the disassembly.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm">modulo:
<span style="color:#a6e22e">endbr32</span> 
<span style="color:#a6e22e">push</span>    ebp <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     ebp, esp <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">sub</span>     esp, <span style="color:#ae81ff">0x10</span>
<span style="color:#a6e22e">call</span>    __x86.get_pc_thunk.ax
<span style="color:#a6e22e">add</span>     eax, <span style="color:#ae81ff">0x2e20</span>  <span style="color:#960050;background-color:#1e0010">{</span>_GLOBAL_OFFSET_TABLE_<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x8</span> <span style="color:#960050;background-color:#1e0010">{</span>var_c<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0x6</span>
<span style="color:#a6e22e">mov</span>     ecx, <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x8</span> <span style="color:#960050;background-color:#1e0010">{</span>var_c<span style="color:#960050;background-color:#1e0010">}</span>]
<span style="color:#a6e22e">mov</span>     edx, <span style="color:#ae81ff">0x55555556</span>
<span style="color:#a6e22e">mov</span>     eax, ecx
<span style="color:#a6e22e">imul</span>    edx
<span style="color:#a6e22e">mov</span>     eax, ecx
<span style="color:#a6e22e">sar</span>     eax, <span style="color:#ae81ff">0x1f</span>
<span style="color:#a6e22e">sub</span>     edx, eax
<span style="color:#a6e22e">mov</span>     eax, edx
<span style="color:#a6e22e">add</span>     eax, eax
<span style="color:#a6e22e">add</span>     eax, edx
<span style="color:#a6e22e">sub</span>     ecx, eax
<span style="color:#a6e22e">mov</span>     edx, ecx
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x4</span> <span style="color:#960050;background-color:#1e0010">{</span>var_8<span style="color:#960050;background-color:#1e0010">}</span>], edx
<span style="color:#a6e22e">mov</span>     eax, <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x4</span> <span style="color:#960050;background-color:#1e0010">{</span>var_8<span style="color:#960050;background-color:#1e0010">}</span>]
<span style="color:#a6e22e">leave</span>    <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">retn</span>     <span style="color:#960050;background-color:#1e0010">{</span>__return_addr<span style="color:#960050;background-color:#1e0010">}</span>
</code></pre></div><p>I&rsquo;ll skip the usual variable setup here since its becoming a little beyond repetitive and get straight to the &lsquo;meat&rsquo; of the function.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm"><span style="color:#a6e22e">mov</span>     ecx, <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x8</span> <span style="color:#960050;background-color:#1e0010">{</span>var_c<span style="color:#960050;background-color:#1e0010">}</span>]
<span style="color:#a6e22e">mov</span>     edx, <span style="color:#ae81ff">0x55555556</span>
<span style="color:#a6e22e">mov</span>     eax, ecx
<span style="color:#a6e22e">imul</span>    edx
<span style="color:#a6e22e">mov</span>     eax, ecx
<span style="color:#a6e22e">sar</span>     eax, <span style="color:#ae81ff">0x1f</span>
<span style="color:#a6e22e">sub</span>     edx, eax
<span style="color:#a6e22e">mov</span>     eax, edx
<span style="color:#a6e22e">add</span>     eax, eax
<span style="color:#a6e22e">add</span>     eax, edx
<span style="color:#a6e22e">sub</span>     ecx, eax
<span style="color:#a6e22e">mov</span>     edx, ecx
</code></pre></div><p>What in the fuck is happening here? Personally the most confusing elements when first presented with this is</p>
<ol>
<li>Where and why do we have the big fuck off number being moved into <code>edx</code>?</li>
<li>Why do we have a <code>imul</code> instruction when we are dealing with modulo (ofc we don&rsquo;t know this normally)?</li>
</ol>
<p>My strategy when I first encountered it was to punch &ldquo;big fuck off constant in disassembly&rdquo; into a search bar. Which unsurprisingly did not yield particularly helpful results, eventually however I uncovered a <a href="https://stackoverflow.com/questions/41183935/why-does-gcc-use-multiplication-by-a-strange-number-in-implementing-integer-divi">stack overflow</a> post which is only 4 years old that lead to a bunch of helpful resources including <a href="https://ridiculousfish.com/blog/posts/labor-of-division-episode-i.html">this</a> excellent blog.</p>
<p>Basically, in short, the compiler uses this &lsquo;large fuck off&rsquo; constant as a kind of magic number in order to optimise the modulo operation and indeed more generally division operations, which of course are required for modulo calculations, where the divisor is constant. This last distinction <strong>where the divisor is constant</strong> is important. We saw earlier in our <a href="#divisionc">division</a> that no such large unexplained constant appears. This is because we divide two variables <code>a / b</code> and thus the compiler does not make the optimization.</p>
<p>If we instead had <code>a / 42</code> we would end up with a disassembly like,</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm"><span style="color:#a6e22e">mov</span>     edx, <span style="color:#ae81ff">0x30c30c31</span>
<span style="color:#a6e22e">mov</span>     eax, ecx
<span style="color:#a6e22e">imul</span>    edx
<span style="color:#a6e22e">mov</span>     eax, edx
<span style="color:#a6e22e">sar</span>     eax, <span style="color:#ae81ff">0x3</span>
<span style="color:#a6e22e">sar</span>     ecx, <span style="color:#ae81ff">0x1f</span>
<span style="color:#a6e22e">mov</span>     edx, ecx
<span style="color:#a6e22e">sub</span>     eax, edx
</code></pre></div><p>where the magic number for perform divisions with multiply and shifting is <code>0x30c30c31</code>.</p>
<p>Thus we have a similar output for our modulo operation where our magic number is <code>0x55555556</code>. But how does the compiler select this magic number? The aforementioned <a href="https://ridiculousfish.com/blog/posts/labor-of-division-episode-i.html">blog</a> does a much better of explaining this so I would recommend reading that. I will, however, attempt a explanation of how we convert such logic back into <code>C</code>.</p>
<p>The first step is to identify two key pieces of information:</p>
<ol>
<li>The shift constant</li>
<li>The magic number</li>
</ol>
<p>To obtain the first we must first know what <code>x86</code> shift instructions look like. There are four main ones namely <code>sar</code>, <code>sal</code>, <code>shl</code> and <code>shr</code>. To read more about them have a look <a href="https://www.felixcloutier.com/x86/sal:sar:shl:shr">here</a>. For now it is enough to know of their existence and symbols. In our modulo disassembly we only have one such instruction.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm"><span style="color:#a6e22e">sar</span>     eax, <span style="color:#ae81ff">0x1f</span>
</code></pre></div><p>A &lsquo;shift arithmetic right&rsquo; with operands <code>eax</code> and decimal constant <code>31</code>. Thus our shift constant (1) is <code>31</code>. The next step is equally as straight forward simply take the large hex number and convert it to its decimal form (or not up to you) <code>0x55555556 = 1431655766</code>.</p>
<p>We now do the following:</p>
<ol>
<li>Take the shift constant and add <code>1</code> to it</li>
<li>Take the adjusted shift constant and calculate <code>2</code> to the power of that number</li>
<li>Take that value and divide by <code>x</code> setting the RHS to the value of the magic number</li>
<li>Solve for <code>x</code></li>
</ol>
<p>Thus for our case we would perform the following arithmetic:</p>
<pre><code>shift_constant = 31 + 1
exp_shift = 2**shift_constant

exp_shift / x = 1431655766
x = exp_shift / 1431655766
x = 2**32 / 1431655766
  = 2.99999 ...
  = 3
</code></pre><p>We now have to note that this method of &lsquo;fast&rsquo; division / mod is not perfectly accurate it comes with an associated degree of error. This is why we end up with a modulo constant <code>2.9999</code> repeater which we must then round to the nearest whole number <code>3</code> to obtain the original constant used for the modulo operation. We can now simplify this whole operation into a simple python function like the bellow.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">resolve_constant</span>(magic, shift):
	<span style="color:#66d9ef">return</span> round(<span style="color:#ae81ff">2</span> <span style="color:#f92672">**</span> (shift <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">/</span> magic)
</code></pre></div><p>Putting this all together we can now build out our recovered <code>C</code> snippet.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">int</span>
<span style="color:#a6e22e">modulo</span>()
{
	<span style="color:#66d9ef">int</span> mod_result;
	<span style="color:#66d9ef">int</span> var_c <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>;

	mod_result <span style="color:#f92672">=</span> var_c <span style="color:#f92672">%</span> <span style="color:#ae81ff">3</span>;
	<span style="color:#66d9ef">return</span> mod_result;
}
</code></pre></div><h3 id="conditionalsc"><code>conditionals.c</code></h3>
<p>Now we turn to what makes programs interesting, making decisions.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">int</span>
<span style="color:#a6e22e">conditional</span>()
{
	<span style="color:#66d9ef">int</span> a <span style="color:#f92672">=</span> <span style="color:#ae81ff">9</span>;
	<span style="color:#66d9ef">int</span> b <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>;

	<span style="color:#66d9ef">if</span> (a <span style="color:#f92672">&lt;</span> b)
		<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
	
	<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}


<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {conditional();}
</code></pre></div>

    <br/>
    <img src="https://cybernetic.coffee/images/blog/50_bins/conditionals.png" class="">


<h3 id="forc"><code>for.c</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">void</span>
<span style="color:#a6e22e">for_loop</span>()
{
	<span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> x <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; x <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">10</span>; x<span style="color:#f92672">++</span>)
	{
		<span style="color:#75715e">// spin
</span><span style="color:#75715e"></span>	}
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>() {for_loop();}
</code></pre></div>

    <br/>
    <img src="https://cybernetic.coffee/images/blog/50_bins/for.png" class="">


<h3 id="whilec"><code>while.c</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">void</span>
<span style="color:#a6e22e">while_loop</span>()
{
	<span style="color:#66d9ef">while</span> (<span style="color:#ae81ff">1</span>) 
	{
		<span style="color:#75715e">//spin
</span><span style="color:#75715e"></span>	}
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>() {while_loop();}

</code></pre></div>

    <br/>
    <img src="https://cybernetic.coffee/images/blog/50_bins/while.png" class="">


<h3 id="gotoc"><code>goto.c</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">void</span>
<span style="color:#a6e22e">_goto</span> ()
{
	<span style="color:#66d9ef">int</span> evil <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

	HELL:<span style="color:#66d9ef">do</span>
	{
		evil<span style="color:#f92672">++</span>;
		<span style="color:#66d9ef">if</span> (evil <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">12</span>)
			<span style="color:#66d9ef">goto</span> HELL;

	} <span style="color:#66d9ef">while</span> (<span style="color:#ae81ff">1</span>);

}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>() {_goto();}
</code></pre></div>

    <br/>
    <img src="https://cybernetic.coffee/images/blog/50_bins/goto.png" class="">


<h3 id="arraysc"><code>arrays.c</code></h3>
<p>A wise man once said,</p>
<blockquote>
<p><em>&ldquo;Everything in C is an array&rdquo;</em></p>
</blockquote>
<p>lets take a look at a simple program working with arrays.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">void</span>
<span style="color:#a6e22e">array</span>()
{
	<span style="color:#66d9ef">int</span> fib[] <span style="color:#f92672">=</span> {<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>};
	<span style="color:#66d9ef">char</span> some_vowels[] <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;e&#39;</span>, <span style="color:#e6db74">&#39;i&#39;</span>, <span style="color:#e6db74">&#39;o&#39;</span>, <span style="color:#e6db74">&#39;u&#39;</span>};
	<span style="color:#66d9ef">char</span> brackets[<span style="color:#ae81ff">4</span>][<span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> { <span style="color:#e6db74">&#34;)&#34;</span>, <span style="color:#e6db74">&#34;(&#34;</span>, <span style="color:#e6db74">&#34;}&#34;</span>, <span style="color:#e6db74">&#34;{&#34;</span> };

	<span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> x <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; x <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">4</span>; x<span style="color:#f92672">++</span>){
		printf(<span style="color:#e6db74">&#34;%d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, fib[x]);
		printf(<span style="color:#e6db74">&#34;%c</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, some_vowels[x]);
		printf(<span style="color:#e6db74">&#34;%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, brackets[x]);
	}
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>() {array();}
</code></pre></div>

    <br/>
    <img src="https://cybernetic.coffee/images/blog/50_bins/array.png" class="">


<p>Probably gonna have to crack a new tab for this one (n.t.s might need to write a better image display shortcode &hellip;).</p>
<p>At this point the compiler decided to introduce some protections on the binary in the form of a stack canary and I can&rsquo;t be bothered to rewrite the Makefile so we are going to ignore this and address it later. Look fine, tldr is: takes a &lsquo;random value&rsquo; from this store <code>gs</code> and places it on the stack before the return pointer, if we overflow we damage the value in that &lsquo;variable&rsquo; causing <code>__stack_chk_fail_local</code> to be called, exiting the program before the attacker can redirect code execution. You can read more about how the memory protection works <a href="https://github.com/Angus-C-git/SecSheets/blob/master/Binary%20Exploitation/Theory/MemoryProtections.md#stack-canaries">here</a>.</p>
<p>But now the program. We begin our analysis on the following part of the first block (blissfully unaware of the stack canary setup along with the frame).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm"><span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x20</span> <span style="color:#960050;background-color:#1e0010">{</span>var_24<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0x0</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x1c</span> <span style="color:#960050;background-color:#1e0010">{</span>var_20<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0x1</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x18</span> <span style="color:#960050;background-color:#1e0010">{</span>var_1c<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0x1</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x14</span> <span style="color:#960050;background-color:#1e0010">{</span>var_18<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0x2</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x10</span> <span style="color:#960050;background-color:#1e0010">{</span>var_14<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0x756f6965</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">word</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x28</span> <span style="color:#960050;background-color:#1e0010">{</span>var_2c<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0x29</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">word</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x26</span> <span style="color:#960050;background-color:#1e0010">{</span>var_2a<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0x28</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">word</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x24</span> <span style="color:#960050;background-color:#1e0010">{</span>var_28<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0x7d</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">word</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x22</span> <span style="color:#960050;background-color:#1e0010">{</span>var_26<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0x7b</span>
</code></pre></div><p>Where we basically see what looks like a bunch of variables being initialized. In the future you may find yourself looking ahead after seeing such a block for a pattern we will take a look at next. First lets recall how arrays are layed out in memory. For an array to work as we expect as programmers each &lsquo;element&rsquo; of the array must appear in memory in order, otherwise how could we reliably loop through them or select specific elements? In reality when we iterate over an array we actually just perform simple arithmetic based on the data type we are working with. For example if we have an array of integers we know that each integer &lsquo;element&rsquo; of the array must be <code>4</code> bytes in size (a <code>dword</code>) and thus each element of the array must have <code>4</code> bytes of space between them. This means that from an arbitrary point in the array we can predict were the next element would be by just going another <code>4</code> bytes along in memory from were we are currently.</p>
<p>Similarly if we want the third element in an integer array and we know where that array starts in memory (aka the first element) we can simply take the desired index <code>2</code> (arrays start at <code>0</code> mate) and multiply it by the size <code>4</code> and add the result to the memory address where the array starts to get the address of the third element. To see a diagram and the MIPS version of this logic take a look <a href="https://devsheets.cybernetic.coffee/programming-languages/mips/#1d-arrays">here</a>.</p>
<p>Thus in the above block when we see integers begin assigned continuously at <code>4</code> byte increments away from each other we should become suspicious that array may be involved.</p>
<p>Similar logic can be followed for the brackets array where the two byte strings are allocated at <code>2</code> byte increments in sequence.</p>
<p>Some what interestingly for the character array (<code>some_vowels</code>) the compiler simply allocates the <code>4</code> bytes in a single move via.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm"><span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x10</span> <span style="color:#960050;background-color:#1e0010">{</span>var_14<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0x756f6965</span>
</code></pre></div><p>If we decode <code>0x756f6965</code> from hex to text we get <code>uoie</code> which reversed is our characters <code>eiou</code>. This makes sense when we consider that each char is <code>1</code> byte and we store exactly <code>4</code>.</p>
<p>If we weren&rsquo;t sure that we were working with some arrays at this point the following lines after the loop header are a dead giveaway.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C">mov     eax, dword [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x2c</span> {var_30}]
mov     eax, dword [ebp<span style="color:#f92672">+</span>eax<span style="color:#f92672">*</span><span style="color:#ae81ff">4</span><span style="color:#f92672">-</span><span style="color:#ae81ff">0x20</span> {var_24}]
</code></pre></div><p>Firstly we see that the variable which the loop checks against, the counter variable, is loaded into <code>eax</code>. Then in the next line we see the implementation of our discussion about accessing array elements.</p>
<p>First we see that the memory location of our counter variable <code>var_30</code> is added to the base pointer <code>ebp+eax</code> which gives access to the value stored in the counter. This value is then multiplied by <code>4</code> in accordance with the integer type we are working with <code>ebp+eax*4</code> and then the offset to the start of the array is subtracted <code>ebp+eax*4-0x20</code> to expose the index in the integers array which corresponds to the value of the counter. We then push this value as the last argument to <code>printf</code> and continue.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">void</span>
<span style="color:#a6e22e">array</span>()
{
	<span style="color:#66d9ef">int</span> numbers[] <span style="color:#f92672">=</span> {<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>};
	<span style="color:#66d9ef">char</span> characters <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;e&#39;</span>, <span style="color:#e6db74">&#39;i&#39;</span>, <span style="color:#e6db74">&#39;o&#39;</span>, <span style="color:#e6db74">&#39;u&#39;</span>};
	<span style="color:#66d9ef">char</span> strings[<span style="color:#ae81ff">4</span>][<span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;)&#34;</span>, <span style="color:#e6db74">&#34;(&#34;</span>, <span style="color:#e6db74">&#34;}&#34;</span>, <span style="color:#e6db74">&#34;{&#34;</span>};

	<span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; count <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0x3</span>; count<span style="color:#f92672">++</span>)
	{
		printf(<span style="color:#e6db74">&#34;%d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, numbers[count]);
	}
}
</code></pre></div><p>The next block deals with the &lsquo;unusual&rsquo; case of printing out each of the <code>4</code> characters in the <code>some_vowels</code> array.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm"><span style="color:#a6e22e">lea</span>     edx, [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x10</span> <span style="color:#960050;background-color:#1e0010">{</span>var_14<span style="color:#960050;background-color:#1e0010">}</span>]
<span style="color:#a6e22e">mov</span>     eax, <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x2c</span> <span style="color:#960050;background-color:#1e0010">{</span>var_30<span style="color:#960050;background-color:#1e0010">}</span>]
<span style="color:#a6e22e">add</span>     eax, edx <span style="color:#960050;background-color:#1e0010">{</span>var_14<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">movzx</span>   eax, <span style="color:#66d9ef">byte</span> [eax]
<span style="color:#a6e22e">movsx</span>   eax, al
<span style="color:#a6e22e">sub</span>     esp, <span style="color:#ae81ff">0x8</span>
<span style="color:#a6e22e">push</span>    eax <span style="color:#960050;background-color:#1e0010">{</span>var_48_2<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">lea</span>     eax, [ebx<span style="color:#f92672">-</span><span style="color:#ae81ff">0x1fc4</span>]  <span style="color:#960050;background-color:#1e0010">{</span>data_200c<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">push</span>    eax <span style="color:#960050;background-color:#1e0010">{</span>var_4c<span style="color:#960050;background-color:#1e0010">}</span>  <span style="color:#960050;background-color:#1e0010">{</span>data_200c<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">call</span>    printf
</code></pre></div><p>We similarly load the location of the start of the &lsquo;array&rsquo; into <code>edx</code> and the value of the counter into <code>eax</code>. Then, however, to resolve each of the characters as single bytes we use the <code>movzx</code> and <code>movsx</code> instructions which (essentially) places the byte into the lowest byte of the <code>eax</code> register which we then push to <code>printf</code> as the last argument to print. This is a bit vague but the main thing to take away here is that the <strong>base</strong> of the array is being coupled with the counter to access the arrays elements.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">void</span>
<span style="color:#a6e22e">array</span>()
{
	<span style="color:#66d9ef">int</span> numbers[] <span style="color:#f92672">=</span> {<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>};
	<span style="color:#66d9ef">char</span> characters <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;e&#39;</span>, <span style="color:#e6db74">&#39;i&#39;</span>, <span style="color:#e6db74">&#39;o&#39;</span>, <span style="color:#e6db74">&#39;u&#39;</span>};
	<span style="color:#66d9ef">char</span> strings[<span style="color:#ae81ff">4</span>][<span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;)&#34;</span>, <span style="color:#e6db74">&#34;(&#34;</span>, <span style="color:#e6db74">&#34;}&#34;</span>, <span style="color:#e6db74">&#34;{&#34;</span>};

	<span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; count <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0x3</span>; count<span style="color:#f92672">++</span>)
	{
		printf(<span style="color:#e6db74">&#34;%d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, numbers[count]);
		printf(<span style="color:#e6db74">&#34;%c</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, characters[count]);
	}
}
</code></pre></div><p>That brings us to our last block.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm"><span style="color:#a6e22e">lea</span>     edx, [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x28</span> <span style="color:#960050;background-color:#1e0010">{</span>var_2c<span style="color:#960050;background-color:#1e0010">}</span>]
<span style="color:#a6e22e">mov</span>     eax, <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x2c</span> <span style="color:#960050;background-color:#1e0010">{</span>var_30<span style="color:#960050;background-color:#1e0010">}</span>]
<span style="color:#a6e22e">add</span>     eax, eax
<span style="color:#a6e22e">add</span>     eax, edx <span style="color:#960050;background-color:#1e0010">{</span>var_2c<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">sub</span>     esp, <span style="color:#ae81ff">0xc</span>
<span style="color:#a6e22e">push</span>    eax <span style="color:#960050;background-color:#1e0010">{</span>var_4c_1<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">call</span>    puts
</code></pre></div><p>We start by loading the memory location of the start of the array into <code>edx</code>, as has become a pattern. We then stuff the memory location of the counter <code>var_30</code> into <code>eax</code>. Things get a little weird here but we wield the power of understanding types and sizes so we <code>push()</code> on.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm"><span style="color:#a6e22e">add</span>     eax, eax
<span style="color:#a6e22e">add</span>     eax, edx <span style="color:#960050;background-color:#1e0010">{</span>var_2c<span style="color:#960050;background-color:#1e0010">}</span>
</code></pre></div><p>Why on earth do we add the value of the counter to itself? Is probably the first question. To answer that we recall the type we are working with, we know that each of the &lsquo;elements&rsquo; in the array of strings are <code>2</code> bytes in size. However the <strong>value</strong> of the counter only increases by <code>1</code> each time. Thus to access the next element in the array based off the arrays address in memory and the counter we would need to add <code>1</code> to whatever the counters value is each time in order to access the start of the next strings address. <em>Note we are concerned with the address of the element rather than the value of the element itself here since print functions expect pointers to character arrays (AKA strings)</em>. Thus we can simply add the counter to itself to achieve this &lsquo;indexing by two&rsquo; effect. Finally we push the address of the element to <code>puts</code> add one to our <code>counter</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">void</span>
<span style="color:#a6e22e">array</span>()
{
	<span style="color:#66d9ef">int</span> numbers[] <span style="color:#f92672">=</span> {<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>};
	<span style="color:#66d9ef">char</span> characters <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;e&#39;</span>, <span style="color:#e6db74">&#39;i&#39;</span>, <span style="color:#e6db74">&#39;o&#39;</span>, <span style="color:#e6db74">&#39;u&#39;</span>};
	<span style="color:#66d9ef">char</span> strings[<span style="color:#ae81ff">4</span>][<span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;)&#34;</span>, <span style="color:#e6db74">&#34;(&#34;</span>, <span style="color:#e6db74">&#34;}&#34;</span>, <span style="color:#e6db74">&#34;{&#34;</span>};

	<span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; count <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0x3</span>; count<span style="color:#f92672">++</span>)
	{
		printf(<span style="color:#e6db74">&#34;%d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, numbers[count]);
		printf(<span style="color:#e6db74">&#34;%c</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, characters[count]);
		puts(strings[count]);
	}
}
</code></pre></div><h3 id="functionsc"><code>functions.c</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>

<span style="color:#66d9ef">void</span>
<span style="color:#a6e22e">some_other_function</span>()
{
	<span style="color:#75715e">// ops
</span><span style="color:#75715e"></span>}


<span style="color:#66d9ef">void</span>
<span style="color:#a6e22e">function_calls</span>()
{
	<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>string <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Hello there&#34;</span>;

	printf(<span style="color:#e6db74">&#34;%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, string);
	some_other_function();

}


<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(){function_calls();}
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm">function_calls:
<span style="color:#a6e22e">endbr32</span> 
<span style="color:#a6e22e">push</span>    ebp <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     ebp, esp <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">push</span>    ebx <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebx<span style="color:#960050;background-color:#1e0010">}</span>  <span style="color:#960050;background-color:#1e0010">{</span>_GLOBAL_OFFSET_TABLE_<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">sub</span>     esp, <span style="color:#ae81ff">0x14</span>
<span style="color:#a6e22e">call</span>    __x86.get_pc_thunk.ax
<span style="color:#a6e22e">add</span>     eax, <span style="color:#ae81ff">0x2de7</span>
<span style="color:#a6e22e">lea</span>     edx, [eax<span style="color:#f92672">-</span><span style="color:#ae81ff">0x1fd0</span>]  <span style="color:#960050;background-color:#1e0010">{</span>data_2008, <span style="color:#e6db74">&#34;Hello there&#34;</span><span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0xc</span> <span style="color:#960050;background-color:#1e0010">{</span>var_10<span style="color:#960050;background-color:#1e0010">}</span>], edx  <span style="color:#960050;background-color:#1e0010">{</span>data_2008, <span style="color:#e6db74">&#34;Hello there&#34;</span><span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">sub</span>     esp, <span style="color:#ae81ff">0xc</span>
<span style="color:#a6e22e">push</span>    <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0xc</span> <span style="color:#960050;background-color:#1e0010">{</span>var_10<span style="color:#960050;background-color:#1e0010">}</span>] <span style="color:#960050;background-color:#1e0010">{</span>var_2c<span style="color:#960050;background-color:#1e0010">}</span>  <span style="color:#960050;background-color:#1e0010">{</span>data_2008, <span style="color:#e6db74">&#34;Hello there&#34;</span><span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     ebx, eax  <span style="color:#960050;background-color:#1e0010">{</span>_GLOBAL_OFFSET_TABLE_<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">call</span>    puts
<span style="color:#a6e22e">add</span>     esp, <span style="color:#ae81ff">0x10</span>
<span style="color:#a6e22e">call</span>    some_other_function
<span style="color:#a6e22e">nop</span>     
<span style="color:#a6e22e">mov</span>     ebx, <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x4</span> <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebx<span style="color:#960050;background-color:#1e0010">}</span>]  <span style="color:#960050;background-color:#1e0010">{</span>_GLOBAL_OFFSET_TABLE_<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">leave</span>    <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">retn</span>     <span style="color:#960050;background-color:#1e0010">{</span>__return_addr<span style="color:#960050;background-color:#1e0010">}</span>
</code></pre></div><h3 id="bitshiftsc"><code>bitshifts.c</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C">
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm">
</code></pre></div><h2 id="scoping-and-intermediate-structures">Scoping and Intermediate Structures</h2>
<h3 id="argumentsc"><code>arguments.c</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">void</span>
<span style="color:#a6e22e">some_function_with_args</span>(<span style="color:#66d9ef">int</span> arg0, <span style="color:#66d9ef">char</span> arg1, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>arg2)
{
	printf(<span style="color:#e6db74">&#34;%d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, arg0);
	printf(<span style="color:#e6db74">&#34;%c</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, arg1);
	printf(<span style="color:#e6db74">&#34;%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, ar2);
}


<span style="color:#66d9ef">void</span>
<span style="color:#a6e22e">function_call</span>()
{
	<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>string <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Hello there&#34;</span>;
	<span style="color:#66d9ef">char</span> character <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;A&#39;</span>;

	some_function_with_args(<span style="color:#ae81ff">42</span>, character, string);
}


<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(){function_call();}
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm">function_call:
<span style="color:#a6e22e">endbr32</span> 
<span style="color:#a6e22e">push</span>    ebp <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     ebp, esp <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">sub</span>     esp, <span style="color:#ae81ff">0x18</span>
<span style="color:#a6e22e">call</span>    __x86.get_pc_thunk.ax
<span style="color:#a6e22e">add</span>     eax, <span style="color:#ae81ff">0x2d7c</span>
<span style="color:#a6e22e">lea</span>     eax, [eax<span style="color:#f92672">-</span><span style="color:#ae81ff">0x1fc4</span>]  <span style="color:#960050;background-color:#1e0010">{</span>data_2010, <span style="color:#e6db74">&#34;Hello there&#34;</span><span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0xc</span> <span style="color:#960050;background-color:#1e0010">{</span>var_10<span style="color:#960050;background-color:#1e0010">}</span>], eax  <span style="color:#960050;background-color:#1e0010">{</span>data_2010, <span style="color:#e6db74">&#34;Hello there&#34;</span><span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">byte</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0xd</span> <span style="color:#960050;background-color:#1e0010">{</span>var_11<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0x41</span>
<span style="color:#a6e22e">movsx</span>   eax, <span style="color:#66d9ef">byte</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0xd</span>]  <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#ae81ff">0x41</span><span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">sub</span>     esp, <span style="color:#ae81ff">0x4</span>
<span style="color:#a6e22e">push</span>    <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0xc</span> <span style="color:#960050;background-color:#1e0010">{</span>var_10<span style="color:#960050;background-color:#1e0010">}</span>] <span style="color:#960050;background-color:#1e0010">{</span>var_24<span style="color:#960050;background-color:#1e0010">}</span>  <span style="color:#960050;background-color:#1e0010">{</span>data_2010, <span style="color:#e6db74">&#34;Hello there&#34;</span><span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">push</span>    eax <span style="color:#960050;background-color:#1e0010">{</span>var_28<span style="color:#960050;background-color:#1e0010">}</span>  <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#ae81ff">0x41</span><span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">push</span>    <span style="color:#ae81ff">0x2a</span> <span style="color:#960050;background-color:#1e0010">{</span>var_2c<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">call</span>    some_function_with_args
<span style="color:#a6e22e">add</span>     esp, <span style="color:#ae81ff">0x10</span>
<span style="color:#a6e22e">nop</span>     
<span style="color:#a6e22e">leave</span>    <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">retn</span>     <span style="color:#960050;background-color:#1e0010">{</span>__return_addr<span style="color:#960050;background-color:#1e0010">}</span>
</code></pre></div><p>The called functions assembler looks like.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm">some_function_with_args:
<span style="color:#a6e22e">endbr32</span> 
<span style="color:#a6e22e">push</span>    ebp <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     ebp, esp <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">push</span>    ebx <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebx<span style="color:#960050;background-color:#1e0010">}</span>  <span style="color:#960050;background-color:#1e0010">{</span>_GLOBAL_OFFSET_TABLE_<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">sub</span>     esp, <span style="color:#ae81ff">0x14</span>
<span style="color:#a6e22e">call</span>    __x86.get_pc_thunk.bx
<span style="color:#a6e22e">add</span>     ebx, <span style="color:#ae81ff">0x2dd7</span>
<span style="color:#a6e22e">mov</span>     eax, <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">+</span><span style="color:#ae81ff">0xc</span> <span style="color:#960050;background-color:#1e0010">{</span>arg2<span style="color:#960050;background-color:#1e0010">}</span>]
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">byte</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0xc</span> <span style="color:#960050;background-color:#1e0010">{</span>var_10<span style="color:#960050;background-color:#1e0010">}</span>], al
<span style="color:#a6e22e">sub</span>     esp, <span style="color:#ae81ff">0x8</span>
<span style="color:#a6e22e">push</span>    <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">+</span><span style="color:#ae81ff">0x8</span> <span style="color:#960050;background-color:#1e0010">{</span>arg1<span style="color:#960050;background-color:#1e0010">}</span>] <span style="color:#960050;background-color:#1e0010">{</span>var_28<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">lea</span>     eax, [ebx<span style="color:#f92672">-</span><span style="color:#ae81ff">0x1fcc</span>]  <span style="color:#960050;background-color:#1e0010">{</span>data_2008<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">push</span>    eax  <span style="color:#960050;background-color:#1e0010">{</span>data_2008<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">call</span>    printf
<span style="color:#a6e22e">add</span>     esp, <span style="color:#ae81ff">0x10</span>
<span style="color:#a6e22e">movsx</span>   eax, <span style="color:#66d9ef">byte</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0xc</span> <span style="color:#960050;background-color:#1e0010">{</span>var_10<span style="color:#960050;background-color:#1e0010">}</span>]
<span style="color:#a6e22e">sub</span>     esp, <span style="color:#ae81ff">0x8</span>
<span style="color:#a6e22e">push</span>    eax <span style="color:#960050;background-color:#1e0010">{</span>var_28_1<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">lea</span>     eax, [ebx<span style="color:#f92672">-</span><span style="color:#ae81ff">0x1fc8</span>]  <span style="color:#960050;background-color:#1e0010">{</span>data_200c<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">push</span>    eax  <span style="color:#960050;background-color:#1e0010">{</span>data_200c<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">call</span>    printf
<span style="color:#a6e22e">add</span>     esp, <span style="color:#ae81ff">0x10</span>
<span style="color:#a6e22e">sub</span>     esp, <span style="color:#ae81ff">0xc</span>
<span style="color:#a6e22e">push</span>    <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">+</span><span style="color:#ae81ff">0x10</span> <span style="color:#960050;background-color:#1e0010">{</span>arg3<span style="color:#960050;background-color:#1e0010">}</span>] <span style="color:#960050;background-color:#1e0010">{</span>var_2c<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">call</span>    puts
<span style="color:#a6e22e">add</span>     esp, <span style="color:#ae81ff">0x10</span>
<span style="color:#a6e22e">nop</span>     
<span style="color:#a6e22e">mov</span>     ebx, <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x4</span> <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebx<span style="color:#960050;background-color:#1e0010">}</span>]  <span style="color:#960050;background-color:#1e0010">{</span>_GLOBAL_OFFSET_TABLE_<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">leave</span>    <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">retn</span>     <span style="color:#960050;background-color:#1e0010">{</span>__return_addr<span style="color:#960050;background-color:#1e0010">}</span>
</code></pre></div><h3 id="structsc"><code>structs.c</code></h3>
<p>Structs are a very important structure forming the basis for many data structures in <code>C</code>. Lets explore a simple one.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">struct</span> Tome {
	<span style="color:#66d9ef">char</span> category;
	<span style="color:#66d9ef">int</span> volume;
	<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>title;
};


<span style="color:#66d9ef">struct</span> Tome
<span style="color:#a6e22e">_struct</span>()
{
	<span style="color:#66d9ef">struct</span> Tome tome;

	tome.category <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;A&#39;</span>;
	tome.volume <span style="color:#f92672">=</span> <span style="color:#ae81ff">42</span>;
	tome.title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Computers are Evil&#34;</span>;

	<span style="color:#66d9ef">return</span> tome;
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(){_struct();}
</code></pre></div><p>The accompanying disassembly.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm">_struct:
<span style="color:#a6e22e">endbr32</span> 
<span style="color:#a6e22e">push</span>    ebp <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     ebp, esp <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">sub</span>     esp, <span style="color:#ae81ff">0x10</span>
<span style="color:#a6e22e">call</span>    __x86.get_pc_thunk.ax
<span style="color:#a6e22e">add</span>     eax, <span style="color:#ae81ff">0x2dfc</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">byte</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0xc</span> <span style="color:#960050;background-color:#1e0010">{</span>var_10<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0x41</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x8</span> <span style="color:#960050;background-color:#1e0010">{</span>var_c<span style="color:#960050;background-color:#1e0010">}</span>], <span style="color:#ae81ff">0x2a</span>
<span style="color:#a6e22e">lea</span>     eax, [eax<span style="color:#f92672">-</span><span style="color:#ae81ff">0x1fd0</span>]  <span style="color:#960050;background-color:#1e0010">{</span>data_2008, <span style="color:#e6db74">&#34;Computers are Evil&#34;</span><span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x4</span> <span style="color:#960050;background-color:#1e0010">{</span>var_8<span style="color:#960050;background-color:#1e0010">}</span>], eax  <span style="color:#960050;background-color:#1e0010">{</span>data_2008, <span style="color:#e6db74">&#34;Computers are Evil&#34;</span><span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     eax, <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">+</span><span style="color:#ae81ff">0x8</span> <span style="color:#960050;background-color:#1e0010">{</span>arg1<span style="color:#960050;background-color:#1e0010">}</span>]
<span style="color:#a6e22e">mov</span>     edx, <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0xc</span>]  <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#ae81ff">0x41</span><span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [eax], edx  <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#ae81ff">0x41</span><span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     edx, <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x8</span> <span style="color:#960050;background-color:#1e0010">{</span>var_c<span style="color:#960050;background-color:#1e0010">}</span>]  <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#ae81ff">0x2a</span><span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [eax<span style="color:#f92672">+</span><span style="color:#ae81ff">0x4</span>], edx  <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#ae81ff">0x2a</span><span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     edx, <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x4</span> <span style="color:#960050;background-color:#1e0010">{</span>var_8<span style="color:#960050;background-color:#1e0010">}</span>]  <span style="color:#960050;background-color:#1e0010">{</span>data_2008, <span style="color:#e6db74">&#34;Computers are Evil&#34;</span><span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [eax<span style="color:#f92672">+</span><span style="color:#ae81ff">0x8</span>], edx  <span style="color:#960050;background-color:#1e0010">{</span>data_2008, <span style="color:#e6db74">&#34;Computers are Evil&#34;</span><span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     eax, <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">+</span><span style="color:#ae81ff">0x8</span> <span style="color:#960050;background-color:#1e0010">{</span>arg1<span style="color:#960050;background-color:#1e0010">}</span>]
<span style="color:#a6e22e">leave</span>    <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">retn</span>    <span style="color:#ae81ff">0x4</span> <span style="color:#960050;background-color:#1e0010">{</span>__return_addr<span style="color:#960050;background-color:#1e0010">}</span>
</code></pre></div><p>Naively we may proceed by allocating variables according to their size (&lsquo;type&rsquo;) and obtain a <code>C</code> snippet similar to the following.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">char</span> var_10 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;A&#39;</span>;
<span style="color:#66d9ef">int</span> var_c <span style="color:#f92672">=</span> <span style="color:#ae81ff">42</span>;
<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>var_8 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Computers are Evil&#34;</span>;
</code></pre></div><p>But then we become confused, whats with all these extra <code>mov</code> operations? The First hint at a struct or at the very least a global variable is the appearance of this line.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm"><span style="color:#a6e22e">mov</span>     eax, <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">+</span><span style="color:#ae81ff">0x8</span> <span style="color:#960050;background-color:#1e0010">{</span>arg1<span style="color:#960050;background-color:#1e0010">}</span>]
</code></pre></div><p>Which features the access to a memory location <code>[ebp+0x8 {arg1}]</code>. That is some data before our base pointer. Since we know that no arguments are supplied to the function this must represent a global variable. Regardless of what the global variable is we now know that its memory location is being stored in <code>eax</code> so we can proceed keeping this in mind.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm"><span style="color:#a6e22e">mov</span>     edx, <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0xc</span>]  <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#ae81ff">0x41</span><span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [eax], edx  <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#ae81ff">0x41</span><span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     edx, <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x8</span> <span style="color:#960050;background-color:#1e0010">{</span>var_c<span style="color:#960050;background-color:#1e0010">}</span>]  <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#ae81ff">0x2a</span><span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [eax<span style="color:#f92672">+</span><span style="color:#ae81ff">0x4</span>], edx  <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#ae81ff">0x2a</span><span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     edx, <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x4</span> <span style="color:#960050;background-color:#1e0010">{</span>var_8<span style="color:#960050;background-color:#1e0010">}</span>]  <span style="color:#960050;background-color:#1e0010">{</span>data_2008, <span style="color:#e6db74">&#34;Computers are Evil&#34;</span><span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [eax<span style="color:#f92672">+</span><span style="color:#ae81ff">0x8</span>], edx  <span style="color:#960050;background-color:#1e0010">{</span>data_2008, <span style="color:#e6db74">&#34;Computers are Evil&#34;</span><span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     eax, <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">+</span><span style="color:#ae81ff">0x8</span> <span style="color:#960050;background-color:#1e0010">{</span>arg1<span style="color:#960050;background-color:#1e0010">}</span>]
</code></pre></div><p>Over the next few instructions we will observe the behavior that is critical to the operation of a struct. On the first line our <code>A</code> byte is loaded into <code>edx</code> and on the proceeding line moved into the memory location of <code>eax</code>, the location of the identified &lsquo;global variable&rsquo;. On the next two lines the &lsquo;spice&rsquo; occurs.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm"><span style="color:#a6e22e">mov</span>     edx, <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x8</span> <span style="color:#960050;background-color:#1e0010">{</span>var_c<span style="color:#960050;background-color:#1e0010">}</span>]  <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#ae81ff">0x2a</span><span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [eax<span style="color:#f92672">+</span><span style="color:#ae81ff">0x4</span>], edx  <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#ae81ff">0x2a</span><span style="color:#960050;background-color:#1e0010">}</span>
</code></pre></div><p>Firstly our integer <code>42</code> is stored into <code>edx</code> but then on the next line we store <code>42</code> into the memory location at <code>eax + 4</code> ???</p>
<p>Structs like many structures in <code>C</code>, namely arrays, are simply just &lsquo;contiguous&rsquo; regions in memory (we ignore <a href="https://www.geeksforgeeks.org/data-structure-alignment/">alignment</a> /padding for this conversation). <em>Thus the first member of the struct is also the &lsquo;address&rsquo; of the struct in memory</em>. In our case the first struct member is the char byte <code>A</code> and hence to access the second member of the struct we can simply take the &lsquo;address&rsquo; of the first member and add the size of the data type we are trying to store. Hence since we store an integer value as our second member we &lsquo;index&rsquo; <code>4</code> bytes further from the start of the structs base in memory, leading to the above operation.</p>
<p>This logic follows for the next block.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm"><span style="color:#a6e22e">mov</span>     edx, <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x4</span> <span style="color:#960050;background-color:#1e0010">{</span>var_8<span style="color:#960050;background-color:#1e0010">}</span>]  <span style="color:#960050;background-color:#1e0010">{</span>data_2008, <span style="color:#e6db74">&#34;Computers are Evil&#34;</span><span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [eax<span style="color:#f92672">+</span><span style="color:#ae81ff">0x8</span>], edx  <span style="color:#960050;background-color:#1e0010">{</span>data_2008, <span style="color:#e6db74">&#34;Computers are Evil&#34;</span><span style="color:#960050;background-color:#1e0010">}</span>
</code></pre></div><p>Where we store the <code>char</code> pointer another <code>4</code> bytes further into the struct as the last member. Finally we have the lines.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm"><span style="color:#a6e22e">mov</span>     eax, <span style="color:#66d9ef">dword</span> [ebp<span style="color:#f92672">+</span><span style="color:#ae81ff">0x8</span> <span style="color:#960050;background-color:#1e0010">{</span>arg1<span style="color:#960050;background-color:#1e0010">}</span>]
<span style="color:#a6e22e">leave</span>    <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">retn</span>    <span style="color:#ae81ff">0x4</span> <span style="color:#960050;background-color:#1e0010">{</span>__return_addr<span style="color:#960050;background-color:#1e0010">}</span>
</code></pre></div><p>Where we see the base of the struct (the structs address in memory) being returned from the function. This gives us all the information we need to muddle a <code>C</code> snippet together which describes the program.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#75715e">// declare global struct
</span><span style="color:#75715e"></span><span style="color:#66d9ef">struct</span> Structure {
	<span style="color:#66d9ef">char</span> member_1;
	<span style="color:#66d9ef">int</span> member_2;
	<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>member_3;
}

<span style="color:#75715e">// must declare the type we return in C
</span><span style="color:#75715e"></span><span style="color:#66d9ef">struct</span> Structure
_struct()
{
	<span style="color:#75715e">// need to create a instance of the struct
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">struct</span> Structure structure;

	structure.member_1 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;A&#39;</span>;
	structure.member_2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">42</span>;
	structure.member_3 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Computers are Evil&#34;</span>;
	
	<span style="color:#66d9ef">return</span> structure;
}
</code></pre></div><h3 id="globalsc"><code>globals.c</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">int</span> global_int;
<span style="color:#66d9ef">char</span> global_char;


<span style="color:#66d9ef">void</span>
<span style="color:#a6e22e">get_globals</span>()
{
	global_int <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
	global_char <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;A&#39;</span>;
}


<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(){get_globals();}
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm">get_globals:
<span style="color:#a6e22e">endbr32</span> 
<span style="color:#a6e22e">push</span>    ebp <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     ebp, esp <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">call</span>    __x86.get_pc_thunk.ax
<span style="color:#a6e22e">add</span>     eax, <span style="color:#ae81ff">0x2e23</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword</span> [eax<span style="color:#f92672">+</span><span style="color:#ae81ff">0x30</span>], <span style="color:#ae81ff">0x1</span>  <span style="color:#960050;background-color:#1e0010">{</span>global_int<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">byte</span> [eax<span style="color:#f92672">+</span><span style="color:#ae81ff">0x34</span>], <span style="color:#ae81ff">0x41</span>  <span style="color:#960050;background-color:#1e0010">{</span>global_char<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">nop</span>     
<span style="color:#a6e22e">pop</span>     ebp <span style="color:#960050;background-color:#1e0010">{</span>__saved_ebp<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">retn</span>     <span style="color:#960050;background-color:#1e0010">{</span>__return_addr<span style="color:#960050;background-color:#1e0010">}</span>
</code></pre></div><h3 id="recursionc"><code>recursion.c</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">int</span>
<span style="color:#a6e22e">fib</span>(<span style="color:#66d9ef">int</span> n)
{
	<span style="color:#66d9ef">if</span>(n <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>)
		<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;

	<span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (n <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">||</span> n <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>)
		<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;

	<span style="color:#66d9ef">return</span> fib(n <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span> fib(n <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span>);
}
</code></pre></div>

    <br/>
    <img src="https://cybernetic.coffee/images/blog/50_bins/recursion.png" class="">


<h3 id="switchesc"><code>switches.c</code></h3>
<p>Switches are another classical decision making structure which see a lot of use in large programs and operating systems. When disassembled they generally resemble a set of nested <code>if/else</code> blocks. Lets look at this mock error handler as an example.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">void</span>
<span style="color:#a6e22e">_switch</span>(<span style="color:#66d9ef">int</span> errno)
{
	<span style="color:#66d9ef">switch</span> (errno)
	{
		<span style="color:#66d9ef">case</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>
			printf(<span style="color:#e6db74">&#34;One got us in the end</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
			<span style="color:#66d9ef">break</span>;
		<span style="color:#66d9ef">case</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span>
			printf(<span style="color:#e6db74">&#34;Twosin&#39;t meant 2 be</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
			<span style="color:#66d9ef">break</span>;
		<span style="color:#66d9ef">case</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">:</span>
			printf(<span style="color:#e6db74">&#34;Third time wasn&#39;t the charm</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
			<span style="color:#66d9ef">break</span>;
		<span style="color:#66d9ef">default</span><span style="color:#f92672">:</span>
			printf(<span style="color:#e6db74">&#34;The front fell off</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
			<span style="color:#66d9ef">break</span>;
	}
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>() {_switch(<span style="color:#ae81ff">4</span>);}
</code></pre></div>

    <br/>
    <img src="https://cybernetic.coffee/images/blog/50_bins/switch.png" class="">


<p>Its probably a good idea to view the image in another tab since its microscopic. Now at this point we might guess we are dealing with a switch, or at least after looking at this, however it is also perfectly possible to represent this as a series of <code>if/else</code> blocks. So lets start by doing that.</p>
<p>We begin by modeling out all the simple stuff and the rough scaffold. We also note that the first variable we see used <code>arg1</code> comes from <code>[ebp+0x8]</code> so we know that it is an argument supplied to the function.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">void</span>
<span style="color:#a6e22e">_switch</span>(<span style="color:#66d9ef">int</span> arg1)
{
	<span style="color:#66d9ef">if</span> (arg1 <span style="color:#f92672">==</span> <span style="color:#ae81ff">3</span>)
	{
		puts(<span style="color:#e6db74">&#34;Third time wasn&#39;t the charm&#34;</span>);
	}

	<span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (arg1 <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">3</span>)
	{
		<span style="color:#66d9ef">if</span> (arg1 <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>) {
			puts(<span style="color:#e6db74">&#34;One got us in the end&#34;</span>);
		}

		<span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (arg1 <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>) {
			puts(<span style="color:#e6db74">&#34;Twosin&#39;t meant 2 be&#34;</span>);
		}

		<span style="color:#66d9ef">else</span> {
			puts(<span style="color:#e6db74">&#34;The front fell off&#34;</span>);
		}
	}

	<span style="color:#66d9ef">else</span> {
		puts(<span style="color:#e6db74">&#34;The front fell off&#34;</span>);
	}

	<span style="color:#75715e">// no return
</span><span style="color:#75715e"></span>}
</code></pre></div><p>Now this is a disgusting mess of nested conditions but more importantly we see a couple of key things happening that hit towards the original source switch. Firstly we see that all the conditional <code>if/else</code> blocks check against the same variable <code>arg1</code>. Secondly we see repeated blocks. This could of course be dealt with by checking multiple conditions in the if statements but the structure of this particular program lends itself to simplification with a switch. <em>Another important aspect that I should mention also is that the <code>arg1</code> variable is of a type which is compatible with the switch.</em></p>
<p>Thus we can rewrite the above logic to utilise a switch, we can also reorder the cases because we are human beings and not computers and prefer to look at things in a human logical sequence where <code>1</code> comes before <code>3</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">void</span>
<span style="color:#a6e22e">_switch</span>(<span style="color:#66d9ef">int</span> arg1)
{
	<span style="color:#66d9ef">switch</span>(arg1)
	{
		<span style="color:#66d9ef">case</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>
			puts(<span style="color:#e6db74">&#34;One got us in the end&#34;</span>);
			<span style="color:#66d9ef">break</span>;
		<span style="color:#66d9ef">case</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span>
			puts(<span style="color:#e6db74">&#34;Twosin&#39;t meant 2 be&#34;</span>);
			<span style="color:#66d9ef">break</span>;
		<span style="color:#66d9ef">case</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">:</span>
			puts(<span style="color:#e6db74">&#34;Third time wasn&#39;t the charm&#34;</span>);
			<span style="color:#66d9ef">break</span>;
		<span style="color:#66d9ef">default</span><span style="color:#f92672">:</span>
			puts(<span style="color:#e6db74">&#34;The front fell off&#34;</span>);
			<span style="color:#66d9ef">break</span>;
	}
}
</code></pre></div><h3 id="castingc"><code>casting.c</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C">
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm">
</code></pre></div><h2 id="io">I/O</h2>
<h3 id="filesc"><code>files.c</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C">
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm">
</code></pre></div><h3 id="clic"><code>cli.c</code></h3>
<p>Getting command line arguments is another typical I/O operation.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;string.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#66d9ef">const</span> <span style="color:#f92672">*</span>argv[])
{
	<span style="color:#75715e">/* code */</span>

	<span style="color:#66d9ef">if</span> (argc <span style="color:#f92672">!=</span> <span style="color:#ae81ff">3</span>) {
		printf(<span style="color:#e6db74">&#34;Usage: %s &lt;file&gt; &lt;mode&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, argv[<span style="color:#ae81ff">0</span>]);
		exit(<span style="color:#ae81ff">0</span>);
	}

	FILE <span style="color:#f92672">*</span>fp;

	<span style="color:#66d9ef">if</span> (atoi(argv[<span style="color:#ae81ff">2</span>]))
		fp <span style="color:#f92672">=</span> fopen(argv[<span style="color:#ae81ff">1</span>], <span style="color:#e6db74">&#34;w&#34;</span>);
		
	<span style="color:#66d9ef">else</span> 
		fp <span style="color:#f92672">=</span> fopen(argv[<span style="color:#ae81ff">1</span>], <span style="color:#e6db74">&#34;r&#34;</span>);

	<span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>fp) {
		printf(<span style="color:#e6db74">&#34;Could not open file</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
		exit(<span style="color:#ae81ff">1</span>);
	}

	fclose(fp);
	<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm">
</code></pre></div><h3 id="socketsc"><code>sockets.c</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C">
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm">
</code></pre></div><h2 id="data-structures--basic-algorithms">Data Structures &amp; Basic Algorithms</h2>
<h3 id="linkedlistc"><code>linkedlist.c</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdint.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// Linked list DS
</span><span style="color:#75715e"></span><span style="color:#66d9ef">struct</span> items
{
	<span style="color:#66d9ef">uint8_t</span> tag;
	<span style="color:#66d9ef">struct</span> st <span style="color:#f92672">*</span> next;		
};


<span style="color:#66d9ef">struct</span> items <span style="color:#f92672">*</span> 
<span style="color:#a6e22e">new</span>()
{
	<span style="color:#66d9ef">struct</span> st <span style="color:#f92672">*</span> struct_1;

	<span style="color:#75715e">/*
</span><span style="color:#75715e">		mov struct_2, 0x0;
</span><span style="color:#75715e">		mov count, 0x0;
</span><span style="color:#75715e">	*/</span>
	<span style="color:#66d9ef">struct</span> st <span style="color:#f92672">*</span> struct_2 <span style="color:#f92672">=</span> NULL;
	<span style="color:#66d9ef">int</span> count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

	<span style="color:#66d9ef">while</span> (count <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">9</span>) 
	{
		struct_1 <span style="color:#f92672">=</span> (<span style="color:#66d9ef">struct</span> st <span style="color:#f92672">*</span>) malloc(<span style="color:#ae81ff">8</span>);
		
		<span style="color:#75715e">// malloc failed
</span><span style="color:#75715e"></span>		<span style="color:#66d9ef">if</span> (struct_1 <span style="color:#f92672">==</span> NULL) exit(<span style="color:#ae81ff">1</span>);


		<span style="color:#66d9ef">if</span> (struct_2 <span style="color:#f92672">==</span> NULL)
		{
			struct_2 <span style="color:#f92672">=</span> struct_1;
		}

		<span style="color:#66d9ef">else</span> 
		{
			struct_1<span style="color:#f92672">-&gt;</span>next <span style="color:#f92672">=</span> struct_2;
			struct_2 <span style="color:#f92672">=</span> struct_1;
		}

		struct_1<span style="color:#f92672">-&gt;</span>next <span style="color:#f92672">=</span> NULL; 
		struct_1<span style="color:#f92672">-&gt;</span>tag <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;A&#39;</span> <span style="color:#f92672">+</span> count;
		count<span style="color:#f92672">++</span>; 
	}

	<span style="color:#66d9ef">return</span> struct_2;
}


<span style="color:#66d9ef">void</span> 
<span style="color:#a6e22e">main</span>()
{	
	<span style="color:#75715e">// __Compile__
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}
</code></pre></div>

    <br/>
    <img src="https://cybernetic.coffee/images/blog/50_bins/linkedlist.png" class="">


<h3 id="queuec"><code>queue.c</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#75715e">//todo
</span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm">
</code></pre></div><h3 id="stackc"><code>stack.c</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#75715e">//todo
</span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm">
</code></pre></div><h3 id="hashtablec"><code>hashtable.c</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#75715e">//todo
</span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm">
</code></pre></div><h3 id="treesc"><code>trees.c</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#75715e">//todo
</span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm">
</code></pre></div><h2 id="complete-programs">&lsquo;Complete&rsquo; Programs</h2>
<p>Lets put our new skills to the test and reverse some larger programs which combine a lot of the elements we see above.</p>
<h3 id="argmultiplexer"><code>argmultiplexer</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;string.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">/*
</span><span style="color:#75715e">Argument struct:
</span><span style="color:#75715e">
</span><span style="color:#75715e">    - Example argument foramt:
</span><span style="color:#75715e">        -arg, --argument
</span><span style="color:#75715e">
</span><span style="color:#75715e">    @arg_count:
</span><span style="color:#75715e">        + The number of arguments
</span><span style="color:#75715e">          the argument expects.
</span><span style="color:#75715e">    @quick_tack:
</span><span style="color:#75715e">        + argument short form
</span><span style="color:#75715e">    @full_tack:
</span><span style="color:#75715e">        + argument long form
</span><span style="color:#75715e">    @help
</span><span style="color:#75715e">        + argument help info
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">struct</span> arg {
    <span style="color:#66d9ef">int</span> arg_count;
    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span> quick_tack;
    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span> full_tack;
    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span> help;
};


<span style="color:#75715e">/* parse arguments into struct */</span>
<span style="color:#66d9ef">struct</span> arg <span style="color:#a6e22e">new_arg</span>() {

    <span style="color:#66d9ef">struct</span> arg new_argument;

    <span style="color:#66d9ef">int</span> arg_count;
    <span style="color:#66d9ef">char</span> short_form[<span style="color:#ae81ff">6</span>];
    <span style="color:#66d9ef">char</span> long_form[<span style="color:#ae81ff">15</span>];
    <span style="color:#66d9ef">char</span> help[<span style="color:#ae81ff">42</span>];

    <span style="color:#66d9ef">char</span> quick_tack[<span style="color:#ae81ff">10</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;-&#34;</span>;
    <span style="color:#66d9ef">char</span> full_tack[<span style="color:#ae81ff">15</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;--&#34;</span>;


    printf(<span style="color:#e6db74">&#34;Enter expected argument no: &#34;</span>);
    scanf(<span style="color:#e6db74">&#34;%d&#34;</span>, <span style="color:#f92672">&amp;</span>arg_count);
    getchar();

    <span style="color:#66d9ef">if</span> (arg_count <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">||</span> arg_count <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">3</span>) {
        printf(<span style="color:#e6db74">&#34;Invalid argument count.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
        exit(<span style="color:#ae81ff">1</span>);
    }

    printf(<span style="color:#e6db74">&#34;Enter argument short form: &#34;</span>);
    fgets(short_form, <span style="color:#ae81ff">6</span>, stdin);
    printf(<span style="color:#e6db74">&#34;Enter argument long form: &#34;</span>);
    fgets(long_form, <span style="color:#ae81ff">15</span>, stdin);
    printf(<span style="color:#e6db74">&#34;Enter argument help info: &#34;</span>);
    fgets(help, <span style="color:#ae81ff">42</span>, stdin);

    short_form[strlen(short_form) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;\0&#39;</span>;
    long_form[strlen(long_form) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;\0&#39;</span>;
    help[strlen(help) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;\0&#39;</span>;  

    strcat(quick_tack, short_form);
    strcat(full_tack, long_form);

    new_argument.arg_count <span style="color:#f92672">=</span> arg_count;
    new_argument.quick_tack <span style="color:#f92672">=</span> quick_tack;
    new_argument.full_tack <span style="color:#f92672">=</span> full_tack;
    new_argument.help <span style="color:#f92672">=</span> help;
    
    printf(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">Generated new argument:</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>);
    printf(<span style="color:#e6db74">&#34;    %s, %s, [%d]        %s&#34;</span>, new_argument.quick_tack, 
                                    new_argument.full_tack, 
                                    new_argument.arg_count, 
                                    new_argument.help
    );
    printf(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);


    <span style="color:#66d9ef">return</span> new_argument;
}

<span style="color:#66d9ef">int</span> 
<span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#66d9ef">const</span> <span style="color:#f92672">*</span>argv[])
{
    <span style="color:#75715e">/* parse arguments */</span>
    <span style="color:#66d9ef">struct</span> arg argument <span style="color:#f92672">=</span> new_arg();

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}
</code></pre></div><p><em>This horrible image brought to you by overlaying screenshots in draw.io, no I will not use GIMP.</em></p>


    <br/>
    <img src="https://cybernetic.coffee/images/blog/50_bins/argmultiplexer.png" class="">


<h3 id="quickmafs"><code>quickmafs</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;string.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>

<span style="color:#75715e">/*
</span><span style="color:#75715e">+ A poor mans calculator in C
</span><span style="color:#75715e">
</span><span style="color:#75715e">+ BODMAS is not here
</span><span style="color:#75715e">*/</span>


<span style="color:#66d9ef">void</span>
<span style="color:#a6e22e">quickmafs</span>()
{
    <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> operators[<span style="color:#ae81ff">4</span>][<span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#34;*&#34;</span>,
        <span style="color:#e6db74">&#34;+&#34;</span>,
        <span style="color:#e6db74">&#34;-&#34;</span>,
        <span style="color:#e6db74">&#34;/&#34;</span>
    };

	<span style="color:#66d9ef">char</span> expression[<span style="color:#ae81ff">20</span>];
	<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span> savepoint;

	<span style="color:#66d9ef">int</span> res;
	<span style="color:#66d9ef">int</span> left_operand;
	<span style="color:#66d9ef">int</span> right_operand;
	<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>operator;


	<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>token;
	<span style="color:#66d9ef">while</span> (<span style="color:#ae81ff">1</span>) {
        printf(<span style="color:#e6db74">&#34;&lt;&lt;&lt; &#34;</span>);
		fgets(expression, <span style="color:#ae81ff">20</span>, stdin);
        expression[strlen(expression) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;\0&#39;</span>;
        savepoint <span style="color:#f92672">=</span> strdup(expression);

		<span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> opchar <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; opchar <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">3</span>; opchar<span style="color:#f92672">++</span>)
		{

			token <span style="color:#f92672">=</span> strtok(expression, operators[opchar]);

			<span style="color:#66d9ef">if</span> (strlen(token) <span style="color:#f92672">==</span> strlen(savepoint))
				<span style="color:#66d9ef">continue</span>;		
		
			operator <span style="color:#f92672">=</span> strdup(operators[opchar]);
			left_operand <span style="color:#f92672">=</span> atoi(token);
			<span style="color:#66d9ef">break</span>;
		}

		token <span style="color:#f92672">=</span> strtok(NULL, operator);
		right_operand <span style="color:#f92672">=</span> atoi(token);

		<span style="color:#66d9ef">switch</span>(operator[<span style="color:#ae81ff">0</span>])
		{
	        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;*&#39;</span><span style="color:#f92672">:</span>
	            res <span style="color:#f92672">=</span> left_operand <span style="color:#f92672">*</span> right_operand;
	            <span style="color:#66d9ef">break</span>;
	        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;+&#39;</span><span style="color:#f92672">:</span>
	            res <span style="color:#f92672">=</span> left_operand <span style="color:#f92672">+</span> right_operand;
	            <span style="color:#66d9ef">break</span>;
	        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;-&#39;</span><span style="color:#f92672">:</span>
	           	res <span style="color:#f92672">=</span> left_operand <span style="color:#f92672">-</span> right_operand;
	            <span style="color:#66d9ef">break</span>;
	        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;/&#39;</span><span style="color:#f92672">:</span>
	    	    res <span style="color:#f92672">=</span> left_operand <span style="color:#f92672">/</span> right_operand;
	            <span style="color:#66d9ef">break</span>;
	        <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span>
	            printf(<span style="color:#e6db74">&#34;Computer says &#39;no&#39; </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
	            res <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
	            <span style="color:#66d9ef">break</span>;
		}

		printf(<span style="color:#e6db74">&#34;&gt;&gt;&gt; %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, res);
	}
}


<span style="color:#66d9ef">void</span>
<span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">void</span>)
{
    quickmafs();
}
</code></pre></div><p><em>This horrible image brought to you by overlaying screenshots in draw.io, no I will not use GIMP.</em></p>


    <br/>
    <img src="https://cybernetic.coffee/images/blog/50_bins/quickmafs.png" class="">



            </div>
        </article>

        <hr />

        
        <div class="post-info">
            
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="https://cybernetic.coffee/tags/reversing/">reversing</a></span>
        <span class="tag"><a href="https://cybernetic.coffee/tags/hacking/">hacking</a></span>
        <span class="tag"><a href="https://cybernetic.coffee/tags/pentesting/">pentesting</a></span>
        <span class="tag"><a href="https://cybernetic.coffee/tags/x86/">x86</a></span>
        <span class="tag"><a href="https://cybernetic.coffee/tags/exploit-development/">Exploit Development</a></span>
        
    </p>



            <p>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="16" y1="13" x2="8" y2="13"></line>
                    <line x1="16" y1="17" x2="8" y2="17"></line>
                    <polyline points="10 9 9 9 8 9"></polyline>
                </svg>
                7748 Words
            </p>
  		</div>
        


        
            
                <div class="pagination">
                    <div class="pagination__title">
                        <span class="pagination__title-h"></span>

                    </div>

                    <div class="pagination__buttons">
                        
                        <span class="button previous">
                      <a href="https://cybernetic.coffee/blog/forgotten-pwntools/">
                        <span class="button__icon">←</span>
                        <span class="button__text">Forgotten pwntools</span>
                      </a>
                    </span>
                        

                        
                            <span class="button next">
                              <a href="https://cybernetic.coffee/blog/basic-stack-based-overflows/">
                                <span class="button__text">Basic Stack Based Overflows</span>
                                <span class="button__icon">→</span>
                              </a>
                            </span>
                        
                    </div>
                </div>
            
        

    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Hacked together with &#10084; by <a href="https://github.com/Angus-C-git">Angus C</a> <i class='fas fa-ghost'></i> </span>
          </div>
    </div>
</footer>

            
        </div>

        




<script type="text/javascript" src="/bundle.min.549d9d8402283235466245c699b04a81b6fb2c75fc03669ba95af9f5e8ad22ab134f177abab9e431efc3441fe5921fd3fb3f8bf50f66dffbdce9eb7994ef69dc.js" integrity="sha512-VJ2dhAIoMjVGYkXGmbBKgbb7LHX8A2abqVr59eitIqsTTxd6urnkMe/DRB/lkh/T&#43;z&#43;L9Q9m3/vc6et5lO9p3A=="></script>



    </body>
</html>
